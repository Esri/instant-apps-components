<!-- /*
 *   Copyright (c) 2022 Esri
 *   All rights reserved.
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *   http://www.apache.org/licenses/LICENSE-2.0
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */ -->

<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>ArcGIS Instant Apps Components</title>

    <link rel="stylesheet" href="https://jsdev.arcgis.com/4.25/esri/themes/dark/main.css" />
    <script src="https://jsdev.arcgis.com/4.25/"></script>

    <script type="module" src="https://unpkg.com/@esri/calcite-components@1.0.0-beta.86/dist/calcite/calcite.esm.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/@esri/calcite-components@1.0.0-beta.86/dist/calcite/calcite.css" />
    <script type="module" src="/build/instant-apps-components.esm.js"></script>
    <script nomodule src="/build/instant-apps-components.js"></script>

    <style>
      html,
      body,
      #viewDiv {
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <calcite-shell>
      <instant-apps-header
        slot="header"
        title-text="10.3 Interactive Legend"
        text-color="#f8f8f8"
        background-color="#151515"
        logo-image="https://www.esri.com/content/dam/esrisites/en-us/common/icons/product-logos/arcgis-instant-apps-64.svg"
        logo-image-alt-text="ArcGIS Instant Apps logo"
        logo-link="https://www.esri.com/en-us/arcgis/products/arcgis-instant-apps/overview"
      >
        <instant-apps-social-share slot="actions-end" popover-button-icon-scale="s"></instant-apps-social-share>
      </instant-apps-header>
      <calcite-shell-panel slot="primary-panel" position="start">
        <calcite-panel></calcite-panel>
      </calcite-shell-panel>
      <div id="viewDiv"></div>
    </calcite-shell>

    <script>
      require([
        'esri/WebMap',
        'esri/views/MapView',
        'esri/layers/FeatureLayer',
        'esri/widgets/FeatureTable',
        'esri/core/watchUtils',
        'esri/widgets/Legend',
        'esri/config',
        'esri/widgets/Home',
      ], (WebMap, MapView, FeatureLayer, FeatureTable, watchUtils, Legend, esriConfig, Home) => {
        esriConfig.portalUrl = 'https://holistic.mapsdevext.arcgis.com';
        const webmapConfig = { portalItem: { id: '7e252d7ebdc448378e7d1c3ff15c5703' } };
        const map = new WebMap(webmapConfig);

        const container = 'viewDiv';
        const view = new MapView({ map, container });

        const home = new Home({ view });
        view.ui.add(home, 'top-left');

        const calcitePanel = document.querySelector('calcite-panel');

        const initIntLegend = async () => {
          const loadedMap = await map.loadAll();
          const interactiveLegend = document.createElement('instant-apps-interactive-legend');
          interactiveLegend.featureCount = true;
          interactiveLegend.zoomTo = true;
          // interactiveLegend.filterMode = {
          //   type: 'effect',
          //   effect: {
          //     // DROP SHADOW
          //     includedEffect: 'drop-shadow(4px, 4px, 4px, #000000)',
          //     excludedEffect: '',
          //     // // BLOOM
          //     // excludedEffect: 'opacity(65%)',
          //     // includedEffect: 'bloom(1.3, 0.75px, 0.3)',
          //     // // GRAYSCALE
          //     // excludedEffect: 'grayscale(100%) opacity(50%)',
          //     // includedEffect: '',
          //   },
          // };
          interactiveLegend.filterMode = {
            type: 'filter',
          };
          interactiveLegend.theme = 'dark';
          interactiveLegend.view = view;
          calcitePanel.appendChild(interactiveLegend);
        };

        view.when(initIntLegend());
      });
    </script>
  </body>
</html>
