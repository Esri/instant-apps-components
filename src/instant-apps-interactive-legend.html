<!-- /*
 *   Copyright (c) 2023 Esri
 *   All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 *   This material is licensed for use under the Esri Master License Agreement (MLA), and is bound by the terms of that agreement.
 *   You may redistribute and use this code without modification, provided you adhere to the terms of the MLA and include this copyright notice.
 *   See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
 */ -->

<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>ArcGIS Instant Apps Components</title>

    <link id="jsapiStyles" rel="stylesheet" href="https://js.arcgis.com/next/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/next/init.js"></script>
    <script type="module" src="https://js.arcgis.com/calcite-components/1.0.7/calcite.esm.js"></script>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/calcite-components/1.0.7/calcite.css" />
    <script type="module" src="/build/instant-apps-components.esm.js"></script>
    <script nomodule src="/build/instant-apps-components.js"></script>

    <style>
      html,
      body,
      #viewDiv {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #testSettings {
        padding: 20px;
      }
    </style>
  </head>

  <body>
    <calcite-shell>
      <calcite-shell-panel slot="panel-start">
        <calcite-panel>
          <div id="testSettings">
            <calcite-label>
              Theme
              <calcite-select id="theme">
                <calcite-option value="light">Light</calcite-option>
                <calcite-option value="dark">Dark</calcite-option>
              </calcite-select>
            </calcite-label>
          </div>
        </calcite-panel>
      </calcite-shell-panel>
      <calcite-shell-panel id="intLegendPanel" slot="panel-end"></calcite-shell-panel>
      <div id="viewDiv"></div>
    </calcite-shell>

    <script>
      require(['esri/WebMap', 'esri/widgets/Home', 'esri/views/MapView', 'esri/core/reactiveUtils', 'esri/config'], (WebMap, Home, MapView, reactiveUtils, esriConfig) => {
        esriConfig.portalUrl = 'http://nw-brews.mapsdevext.arcgis.com';

        const createView = () => {
          const map = new WebMap({
            portalItem: {
              id: '878ba85edaa845b898f1cace4817d949',
            },
          });

          return new MapView({
            map,
            container: 'viewDiv',
          });
        };

        const createIntLegend = () => {
          const legend = document.createElement('instant-apps-interactive-legend');
          legend.id = 'intLegend';
          legend.classList.add('calcite-mode-light');
          legend.view = view;
          legend.zoomTo = true;
          legend.featureCount = true;

          const intLegendPanel = document.getElementById('intLegendPanel');
          intLegendPanel.appendChild(legend);
        };

        const addWidgets = () => {
          const home = new Home({ view });
          view.ui.add(home, 'top-left');
        };

        const view = createView();
        createIntLegend();
        addWidgets();
      });

      const setupThemeEventListener = () => {
        const select = document.getElementById('theme');
        const themeCallback = e => {
          const intLegend = document.getElementById('intLegend');
          const value = e.target.value;

          intLegend.classList.remove('calcite-mode-light');
          intLegend.classList.remove('calcite-mode-dark');
          intLegend.classList.add(`calcite-mode-${value}`);
        };
        select.addEventListener('calciteSelectChange', themeCallback);
      };

      const setupEventListeners = () => {
        setupThemeEventListener();
      };

      setupEventListeners();
    </script>
  </body>
</html>
