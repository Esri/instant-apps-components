import{b as t,n as e,r as i,h as r,c as s,d as n,f as o,N as a,g as l,l as h,i as u,q as c,k as d,t as f,E as p,o as g,p as m,A as v,u as w,w as b,x as y,Q as k,y as x,U as S,z as _,B as A,C as I,D as O,F as j,G as T,H as E,I as U,J as N,K as z,L as P,O as C,P as R,R as D,S as F,T as M,V as q,s as $,W as L,X as B,Y as G,Z as V,_ as H,$ as J,a0 as W,a1 as Y,a2 as X,a3 as Z,a4 as K,a5 as Q,a6 as tt}from"./p-a824b82d.js";import"./p-e510b9d9.js";class et{constructor(){this._emitter=new et.EventEmitter(this)}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}}!function(s){class n{constructor(t=null){this.target=t,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(t,e){const i=this._listenersMap&&this._listenersMap.get(t);if(!i)return!1;const r=this.target||this;return[...i].forEach((t=>{t.call(r,e)})),i.length>0}on(t,e){if(Array.isArray(t)){const r=t.map((t=>this.on(t,e)));return i(r)}if(t.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const r=this._listenersMap.get(t)||[];return r.push(e),this._listenersMap.set(t,r),{remove:()=>{const i=this._listenersMap&&this._listenersMap.get(t)||[],r=i.indexOf(e);r>=0&&i.splice(r,1)}}}once(t,e){const i=this.on(t,(t=>{i.remove(),e.call(null,t)}));return i}hasEventListener(t){const e=this._listenersMap&&this._listenersMap.get(t);return null!=e&&e.length>0}}s.EventEmitter=n,s.EventedMixin=i=>{let r=class extends i{constructor(){super(...arguments),this._emitter=new n}destroy(){this._emitter.clear()}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}};return r=t([e("esri.core.Evented")],r),r};let o=class extends r{constructor(){super(...arguments),this._emitter=new et.EventEmitter(this)}destroy(){this._emitter.clear()}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}};o=t([e("esri.core.Evented")],o),s.EventedAccessor=o}(et||(et={}));const it=et;var rt,st;function nt(t){return(e,i)=>{e[i]=t}}!function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"}(rt||(rt={}));class ot{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new s(this._observers,t)}notify(){const t=this._observers.slice();for(let e=0;e<t.length;++e){const i=t[e];i.onInvalidated(),i.onCommitted()}}}const at=new n(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}},void 0,(t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1})),lt=()=>{};function ht(t){return t?t instanceof wt?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function ut(t){if(t&&t.length)return t[0]}function ct(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function dt(t,e,i,r){e&&e.forEach(((e,s,n)=>{t.push(e),dt(t,i.call(r,e,s,n),i,r)}))}const ft=new Set,pt=new Set,gt=new Set,mt=new Map;let vt=0,wt=st=class extends it.EventedAccessor{constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new ot,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:vt++})}static isCollection(t){return null!=t&&t instanceof st}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof st?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return h(this._observable),this._items}set items(t){this._emitBeforeChanges(rt.ADD)||(this._splice(0,this.length,ht(t)),this._emitAfterChanges(rt.ADD))}hasEventListener(t){return"change"===t?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if("change"===t){const t=this._chgListeners,i={removed:!1,callback:e};return t.push(i),this._notifications&&this._notifications.push({listeners:t.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=lt,i.removed=!0,t.splice(t.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(h(this._observable),this._emitBeforeChanges(rt.ADD))return this;const i=this.getNextIndex(null!=e?e:null);return this._splice(i,0,[t]),this._emitAfterChanges(rt.ADD),this}addMany(t,e=this._items.length){if(h(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(rt.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,ht(t)),this._emitAfterChanges(rt.ADD),this}at(t){if(h(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(h(this._observable),!this.length||this._emitBeforeChanges(rt.REMOVE))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(rt.REMOVE),t}clone(){return h(this._observable),this._createNewInstance({items:this._items.map(u)})}concat(...t){h(this._observable);const e=t.map(ht);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(h(this._observable),!this.length||this._emitBeforeChanges(rt.REMOVE))return;const i=c(this._splice(0,this.length)),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(rt.REMOVE)}every(t,e){return h(this._observable),this._items.every(t,e)}filter(t,e){let i;return h(this._observable),i=2===arguments.length?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return h(this._observable),this._items.find(t,e)}findIndex(t,e){return h(this._observable),this._items.findIndex(t,e)}flatten(t,e){h(this._observable);const i=[];return dt(i,this,t,e),new st(i)}forEach(t,e){return h(this._observable),this._items.forEach(t,e)}getItemAt(t){return h(this._observable),this._items[t]}getNextIndex(t){h(this._observable);const e=this.length;return(t=null==t?e:t)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return h(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return h(this._observable),this._items.indexOf(t,e)}join(t=","){return h(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return h(this._observable),this._items.lastIndexOf(t,e)}map(t,e){h(this._observable);const i=this._items.map(t,e);return new st({items:i})}reorder(t,e=this.length-1){h(this._observable);const i=this.indexOf(t);if(-1!==i){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(rt.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(rt.MOVE)}return t}}pop(){if(h(this._observable),!this.length||this._emitBeforeChanges(rt.REMOVE))return;const t=ut(this._splice(this.length-1,1));return this._emitAfterChanges(rt.REMOVE),t}push(...t){return h(this._observable),this._emitBeforeChanges(rt.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(rt.ADD)),this.length}reduce(t,e){h(this._observable);const i=this._items;return 2===arguments.length?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){h(this._observable);const i=this._items;return 2===arguments.length?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return h(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(h(this._observable),t<0||t>=this.length||this._emitBeforeChanges(rt.REMOVE))return;const e=ut(this._splice(t,1));return this._emitAfterChanges(rt.REMOVE),e}removeMany(t){if(h(this._observable),!t||!t.length||this._emitBeforeChanges(rt.REMOVE))return[];const e=t instanceof st?t.toArray():t,i=this._items,r=[],s=e.length;for(let t=0;t<s;t++){const s=i.indexOf(e[t]);if(s>-1){const n=1+ct(e,i,t+1,s+1),o=this._splice(s,n);o&&o.length>0&&r.push.apply(r,o),t+=n-1}}return this._emitAfterChanges(rt.REMOVE),r}reverse(){if(h(this._observable),this._emitBeforeChanges(rt.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(rt.MOVE),this}shift(){if(h(this._observable),!this.length||this._emitBeforeChanges(rt.REMOVE))return;const t=ut(this._splice(0,1));return this._emitAfterChanges(rt.REMOVE),t}slice(t=0,e=this.length){return h(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return h(this._observable),this._items.some(t,e)}sort(t){if(h(this._observable),!this.length||this._emitBeforeChanges(rt.MOVE))return this;const e=c(this._splice(0,this.length));return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(rt.MOVE),this}splice(t,e,...i){h(this._observable);const r=(e?rt.REMOVE:0)|(i.length?rt.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return h(this._observable),this._items.slice()}toJSON(){return h(this._observable),this.toArray()}toLocaleString(){return h(this._observable),this._items.toLocaleString()}toString(){return h(this._observable),""+this._items}unshift(...t){return h(this._observable),!t.length||this._emitBeforeChanges(rt.ADD)||(this._splice(0,0,t),this._emitAfterChanges(rt.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=d((()=>this._dispatchChange()))),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const e=at.acquire();e.target=this,e.cancellable=!0;for(let i=0,s=o.length;i<s;i++)n=o[i],e.reset(n),this.emit("before-remove",e),e.defaultPrevented&&(o.splice(i,1),r.splice(t,0,n),t+=1,i-=1,s-=1);at.release(e)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const t=at.acquire();t.target=this,t.cancellable=!1;const e=o.length;for(let i=0;i<e;i++)t.reset(o[i]),this.emit("after-remove",t);at.release(t)}}if(i&&i.length){if(s){const t=[];for(const e of i){const i=s.ensureType(e);null==i&&null!=e||t.push(i)}i=t}const e=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),o=t===this.length;if(e||n){const s=at.acquire();s.target=this,s.cancellable=!0;const a=at.acquire();a.target=this,a.cancellable=!1;for(const l of i)e?(s.reset(l),this.emit("before-add",s),s.defaultPrevented||(o?r.push(l):r.splice(t++,0,l),this._set("length",r.length),n&&(a.reset(l),this.emit("after-add",a)))):(o?r.push(l):r.splice(t++,0,l),this._set("length",r.length),a.reset(l),this.emit("after-add",a));at.release(a),at.release(s)}else{if(o)for(const t of i)r.push(t);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=at.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,at.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=at.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),at.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const t=e.changes;ft.clear(),pt.clear(),gt.clear();for(const{added:e,removed:i}of t){if(e)if(0===gt.size&&0===pt.size)for(const t of e)ft.add(t);else for(const t of e)pt.has(t)?(gt.add(t),pt.delete(t)):gt.has(t)||ft.add(t);if(i)if(0===gt.size&&0===ft.size)for(const t of i)pt.add(t);else for(const t of i)ft.has(t)?ft.delete(t):(gt.delete(t),pt.add(t))}const i=f.acquire();ft.forEach((t=>{i.push(t)}));const r=f.acquire();pt.forEach((t=>{r.push(t)}));const s=this._items,n=e.items,o=f.acquire();if(gt.forEach((t=>{n.indexOf(t)!==s.indexOf(t)&&o.push(t)})),e.listeners&&(i.length||r.length||o.length)){const t={target:this,added:i,removed:r,moved:o},s=e.listeners.length;for(let i=0;i<s;i++){const r=e.listeners[i];r.removed||r.callback.call(this,t)}}f.release(i),f.release(r),f.release(o)}ft.clear(),pt.clear(),gt.clear()}};wt.ofType=i=>{if(!i)return st;if(mt.has(i))return mt.get(i);let r=null;if("function"==typeof i)r=i.prototype.declaredClass;else if(i.base)r=i.base.prototype.declaredClass;else for(const t in i.typeMap){const e=i.typeMap[t].prototype.declaredClass;r?r+=" | "+e:r=e}let s=class extends st{};return t([nt({Type:i,ensureType:"function"==typeof i?o(i):a(i)})],s.prototype,"itemType",void 0),s=t([e(`esri.core.Collection<${r}>`)],s),mt.set(i,s),s},t([l()],wt.prototype,"length",void 0),t([l()],wt.prototype,"items",null),wt=st=t([e("esri.core.Collection")],wt);const bt=wt;let yt=class extends r{constructor(t){super(t),this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach((e=>{t+=e.length})),t}add(t,e){if(!this._isHandle(t)&&!Array.isArray(t)&&!bt.isCollection(t))return this;const i=this._getOrCreateGroup(e);return Array.isArray(t)||bt.isCollection(t)?t.forEach((t=>this._isHandle(t)&&i.push(t))):i.push(t),this.notifyChange("size"),this}forEach(t,e){if("function"==typeof t)this._groups.forEach((e=>e.forEach(t)));else{const i=this._getGroup(t);i&&e&&i.forEach(e)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(Array.isArray(t)||bt.isCollection(t))return t.forEach(this.remove,this),this;if(!this.has(t))return this;const e=this._getGroup(t);for(let t=0;t<e.length;t++)e[t].remove();return this._deleteGroup(t),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((t=>{for(let e=0;e<t.length;e++)t[e].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(t){return t&&!!t.remove}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const e=[];return this._groups.set(this._ensureGroupKey(t),e),e}_getGroup(t){return c(this._groups.get(this._ensureGroupKey(t)))}_deleteGroup(t){return this._groups.delete(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}};t([l({readOnly:!0})],yt.prototype,"size",null),yt=t([e("esri.core.Handles")],yt);const kt=yt;var xt;!function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"}(xt||(xt={}));class St{constructor(t){this.instance=t,this._resolver=p(),this._status=xt.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=xt.RESOLVED,this._cleanUp()}),(()=>{this._status=xt.REJECTED,this._cleanUp()}))}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===xt.RESOLVED}isRejected(){return this._status===xt.REJECTED}isFulfilled(){return this._status!==xt.PENDING}abort(){this._resolver.reject(g())}when(t,e){return this._resolver.promise.then(t,e)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=p(),e=[...this._resolvingPromises,c(t.promise)],i=this._allPromise=Promise.all(e);i.then((()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)}),(t=>{this.isFulfilled()||this._allPromise!==i||m(t)||this._resolver.reject(t)})),t.resolve()}}const _t=i=>{let r=class extends i{constructor(...t){super(...t),this._promiseProps=new St(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(t,e){return new Promise(((t,e)=>{this._promiseProps.when(t,e)})).then(t,e)}catch(t){return this.when(null,t)}addResolvingPromise(t){t&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in t?t.when():t)}};return r=t([e("esri.core.Promise")],r),r};let At=class extends(_t(r)){};function It(t,e,i={}){return jt(t,e,i,Tt)}function Ot(t,e,i={}){return jt(t,e,i,Et)}function jt(t,e,i={},r){let s=null;const n=i.once?(t,i)=>{r(t)&&(w(s),e(t,i))}:(t,i)=>{r(t)&&e(t,i)};if(s=v(t,n,i.sync,i.equals),i.initial){const e=t();n(e,e)}return s}function Tt(){return!0}function Et(t){return!!t}At=t([e("esri.core.Promise")],At);const Ut={initial:!0};var Nt=Object.prototype,zt=Function.prototype.toString,Pt=Nt.hasOwnProperty,Ct=zt.call(Object),Rt=Nt.toString,Dt=function(t,e){return function(i){return t(e(i))}}(Object.getPrototypeOf,Object),Ft={exports:{}},Mt={},qt={exports:{}},$t={};function Lt(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var Bt=/javascript\s*\:/gim;$t.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},$t.getDefaultWhiteList=Lt,$t.onAttr=function(){},$t.onIgnoreAttr=function(){},$t.safeAttrValue=function(t,e){return Bt.test(e)?"":e};var Gt=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},Vt=function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")},Ht=$t;function Jt(t){return null==t}function Wt(t){(t=function(t){var e={};for(var i in t)e[i]=t[i];return e}(t||{})).whiteList=t.whiteList||Ht.whiteList,t.onAttr=t.onAttr||Ht.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||Ht.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||Ht.safeAttrValue,this.options=t}Wt.prototype.process=function(t){if(!(t=""+(t=t||"")))return"";var e=this.options,i=e.whiteList,r=e.onAttr,s=e.onIgnoreAttr,n=e.safeAttrValue;return function(t,e){";"!==(t=Vt(t))[t.length-1]&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var i=Gt(t.slice(s,n)),a=i.indexOf(":");if(-1!==a){var l=Gt(i.slice(0,a)),h=Gt(i.slice(a+1));if(l){var u=e(s,o.length,l,h,i);u&&(o+=u+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if("/"===l&&"*"===t[n+1]){var h=t.indexOf("*/",n+2);if(-1===h)break;s=(n=h+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||a():"\n"===l&&a()}return Gt(o)}(t,(function(t,e,o,a,l){var h=i[o],u=!1;if(!0===h?u=h:"function"==typeof h?u=h(a):h instanceof RegExp&&(u=h.test(a)),!0!==u&&(u=!1),a=n(o,a)){var c,d={position:e,sourcePosition:t,source:l,isWhite:u};return u?Jt(c=r(o,a,d))?o+":"+a:c:Jt(c=s(o,a,d))?void 0:c}}))};var Yt=Wt;!function(t,e){var i=$t,r=Yt;for(var s in(e=t.exports=function(t,e){return new r(e).process(t)}).FilterCSS=r,i)e[s]=i[s]}(qt,qt.exports);var Xt={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/.exec(t);return e?e.index:-1}},Zt=qt.exports.getDefaultWhiteList,Kt=Xt;var Qt=new(0,qt.exports.FilterCSS);function te(t){return t.replace(ee,"&lt;").replace(ie,"&gt;")}var ee=/</g,ie=/>/g,re=/"/g,se=/&quot;/g,ne=/&#([a-zA-Z0-9]*);?/gim,oe=/&colon;?/gim,ae=/&newline;?/gim,le=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,he=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ue=/u\s*r\s*l\s*\(.*/gi;function ce(t){return t.replace(re,"&quot;")}function de(t){return t.replace(se,'"')}function fe(t){return t.replace(ne,(function(t,e){return String.fromCharCode("x"===e[0]||"X"===e[0]?parseInt(e.substr(1),16):parseInt(e,10))}))}function pe(t){return t.replace(oe,":").replace(ae," ")}function ge(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Kt.trim(e)}function me(t){return ge(t=pe(t=fe(t=de(t))))}function ve(t){return te(t=ce(t))}Mt.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},Mt.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},Mt.onTag=function(){},Mt.onIgnoreTag=function(){},Mt.onTagAttr=function(){},Mt.onIgnoreTagAttr=function(){},Mt.safeAttrValue=function(t,e,i,r){if(i=me(i),"href"===e||"src"===e){if("#"===(i=Kt.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===e){if(le.lastIndex=0,le.test(i))return""}else if("style"===e){if(he.lastIndex=0,he.test(i))return"";if(ue.lastIndex=0,ue.test(i)&&(le.lastIndex=0,le.test(i)))return"";!1!==r&&(i=(r=r||Qt).process(i))}return ve(i)},Mt.escapeHtml=te,Mt.escapeQuote=ce,Mt.unescapeQuote=de,Mt.escapeHtmlEntities=fe,Mt.escapeDangerHtml5Entities=pe,Mt.clearNonPrintableCharacter=ge,Mt.friendlyAttrValue=me,Mt.escapeAttrValue=ve,Mt.onIgnoreTagStripAll=function(){return""},Mt.StripTagBody=function(t,e){"function"!=typeof e&&(e=function(){});var i=!Array.isArray(t),r=[],s=!1;return{onIgnoreTag:function(n,o,a){if(function(e){return!!i||-1!==Kt.indexOf(t,e)}(n)){if(a.isClosing){return r.push([!1!==s?s:a.position,a.position+10]),s=!1,"[/removed]"}return s||(s=a.position),"[removed]"}return e(n,o,a)},remove:function(t){var e="",i=0;return Kt.forEach(r,(function(r){e+=t.slice(i,r[0]),i=r[1]})),e+=t.slice(i)}}},Mt.stripCommentTag=function(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("\x3c!--",i);if(-1===r){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("--\x3e",r);if(-1===s)break;i=s+3}return e},Mt.stripBlankChar=function(t){var e=t.split("");return(e=e.filter((function(t){var e=t.charCodeAt(0);return!(127===e||e<=31&&10!==e&&13!==e)}))).join("")},Mt.cssFilter=Qt,Mt.getDefaultCSSWhiteList=Zt;var we={},be=Xt;function ye(t){var e=be.spaceIndex(t);if(-1===e)var i=t.slice(1,-1);else i=t.slice(1,e+1);return"/"===(i=be.trim(i).toLowerCase()).slice(0,1)&&(i=i.slice(1)),"/"===i.slice(-1)&&(i=i.slice(0,-1)),i}function ke(t){return"</"===t.slice(0,2)}var xe=/[^a-zA-Z0-9_:\.\-]/gim;function Se(t,e){for(;e<t.length;e++){var i=t[e];if(" "!==i)return"="===i?e:-1}}function _e(t,e){for(;e>0;e--){var i=t[e];if(" "!==i)return"="===i?e:-1}}function Ae(t){return function(t){return'"'===t[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]}(t)?t.substr(1,t.length-2):t}we.parseTag=function(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,h="",u="";t:for(a=0;a<l;a++){var c=t.charAt(a);if(!1===n){if("<"===c){n=a;continue}}else if(!1===o){if("<"===c){r+=i(t.slice(s,a)),n=a,s=a;continue}if(">"===c){r+=i(t.slice(s,n)),h=ye(u=t.slice(n,a+1)),r+=e(n,r.length,h,u,ke(u)),s=a+1,n=!1;continue}if('"'===c||"'"===c)for(var d=1,f=t.charAt(a-d);""===f.trim()||"="===f;){if("="===f){o=c;continue t}f=t.charAt(a-++d)}}else if(c===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r},we.parseAttr=function(t,e){var i=0,r=[],s=!1,n=t.length;function o(t,i){if(!((t=(t=be.trim(t)).replace(xe,"").toLowerCase()).length<1)){var s=e(t,i||"");s&&r.push(s)}}for(var a=0;a<n;a++){var l,h=t.charAt(a);if(!1!==s||"="!==h)if(!1===s||a!==i||'"'!==h&&"'"!==h||"="!==t.charAt(a-1)){if(/\s|\n|\t/.test(h)){if(t=t.replace(/\s|\n|\t/g," "),!1===s){if(-1===(l=Se(t,a))){o(be.trim(t.slice(i,a))),s=!1,i=a+1;continue}a=l-1;continue}if(-1===(l=_e(t,a-1))){o(s,Ae(be.trim(t.slice(i,a)))),s=!1,i=a+1;continue}}}else{if(-1===(l=t.indexOf(h,a+1)))break;o(s,be.trim(t.slice(i+1,l))),s=!1,i=(a=l)+1}else s=t.slice(i,a),i=a+1}return i<t.length&&(!1===s?o(t.slice(i)):o(s,Ae(be.trim(t.slice(i))))),be.trim(r.join(" "))};var Ie=qt.exports.FilterCSS,Oe=Mt,je=we.parseTag,Te=we.parseAttr,Ee=Xt;function Ue(t){return null==t}function Ne(t){(t=function(t){var e={};for(var i in t)e[i]=t[i];return e}(t||{})).stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Oe.onIgnoreTagStripAll),t.whiteList=t.whiteList||Oe.whiteList,t.onTag=t.onTag||Oe.onTag,t.onTagAttr=t.onTagAttr||Oe.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Oe.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Oe.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Oe.safeAttrValue,t.escapeHtml=t.escapeHtml||Oe.escapeHtml,this.options=t,!1===t.css?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new Ie(t.css))}Ne.prototype.process=function(t){if(!(t=""+(t=t||"")))return"";var e=this.options,i=e.whiteList,r=e.onTag,s=e.onIgnoreTag,n=e.onTagAttr,o=e.onIgnoreTagAttr,a=e.safeAttrValue,l=e.escapeHtml,h=this.cssFilter;e.stripBlankChar&&(t=Oe.stripBlankChar(t)),e.allowCommentTag||(t=Oe.stripCommentTag(t));var u=!1;e.stripIgnoreTagBody&&(u=Oe.StripTagBody(e.stripIgnoreTagBody,s),s=u.onIgnoreTag);var c=je(t,(function(t,e,u,c,d){var f,p={sourcePosition:t,position:e,isClosing:d,isWhite:i.hasOwnProperty(u)};if(!Ue(f=r(u,c,p)))return f;if(p.isWhite){if(p.isClosing)return"</"+u+">";var g=function(t){var e=Ee.spaceIndex(t);if(-1===e)return{html:"",closing:"/"===t[t.length-2]};var i="/"===(t=Ee.trim(t.slice(e+1,-1)))[t.length-1];return i&&(t=Ee.trim(t.slice(0,-1))),{html:t,closing:i}}(c),m=i[u],v=Te(g.html,(function(t,e){var i,r=-1!==Ee.indexOf(m,t);return Ue(i=n(u,t,e,r))?r?(e=a(u,t,e,h))?t+'="'+e+'"':t:Ue(i=o(u,t,e,r))?void 0:i:i}));return c="<"+u,v&&(c+=" "+v),g.closing&&(c+=" /"),c+">"}return Ue(f=s(u,c,p))?l(c):f}),l);return u&&(c=u.remove(c)),c};var ze=Ne;!function(t,e){var i=Mt,r=we,s=ze;function n(t,e){return new s(e).process(t)}for(var o in(e=t.exports=n).filterXSS=n,e.FilterXSS=s,i)e[o]=i[o];for(var o in r)e[o]=r[o];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=t.exports)}(Ft,Ft.exports);var Pe=function(){function t(t,e){var i,r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(t,e,i,s){return"a"===t&&"href"===e||("img"===t||"source"===t)&&"src"===e?r.sanitizeUrl(i):Ft.exports.safeAttrValue(t,e,i,s)}},t&&!e?i=t:t&&e?(i=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach((function(e){"whiteList"===e?i.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):i[e]=t[e]}))):(i=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=i,this._xssFilter=new Ft.exports.FilterXSS(i)}return t.prototype.sanitize=function(t,e){switch(void 0===e&&(e={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,e);default:if(e.allowUndefined&&void 0===t)return;return null}},t.prototype.sanitizeUrl=function(t){var e=this._trim(t.substring(0,t.indexOf(":")));return"/"===t||"#"===t||"#"===t[0]||this.allowedProtocols.indexOf(e.toLowerCase())>-1?Ft.exports.escapeAttrValue(t):""},t.prototype.sanitizeHTMLAttribute=function(t,e,i,r){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(t,e,i,r):Ft.exports.safeAttrValue(t,e,i,r)},t.prototype.validate=function(t,e){void 0===e&&(e={});var i=this.sanitize(t,e);return{isValid:t===i,sanitized:i}},t.prototype._extendObjectOfArrays=function(t){var e={};return t.forEach((function(t){Object.keys(t).forEach((function(i){e[i]=Array.isArray(t[i])&&Array.isArray(e[i])?e[i].concat(t[i]):t[i]}))})),e},t.prototype._iterateOverObject=function(t,e){var i=this;void 0===e&&(e={});try{var r=!1,s=void 0;if(Array.isArray(t))s=t.reduce((function(t,s){var n=i.validate(s,e);return n.isValid?t.concat([s]):(r=!0,t.concat([n.sanitized]))}),[]);else{if(!function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||"[object Object]"!=Rt.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t))return!1;var e=Dt(t);if(null===e)return!0;var i=Pt.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&zt.call(i)==Ct}(t)){if(e.allowUndefined&&void 0===t)return;return null}s=Object.keys(t).reduce((function(s,n){var o=t[n],a=i.validate(o,e);return a.isValid?s[n]=o:(r=!0,s[n]=a.sanitized),s}),{})}return r?s:t}catch(t){return null}},t.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},t}();const Ce=new Map;function Re(){Ce.clear()}function De(t){Ce.delete(t)}function Fe(t){const e=f.acquire();for(let t=0;t<arguments.length;t++){const i=arguments[t],r=typeof i;if("string"===r)e.push(i);else if(Array.isArray(i))e.push.apply(e,i);else if("object"===r)for(const t in i)i[t]&&e.push(t)}const i=e.join(" ");return f.release(e),i}function Me(t){this[t.getAttribute("data-node-ref")]=t}b.getLogger("esri.widgets.support.widgetUtils"),(()=>{const t=new Map;new ResizeObserver((e=>{Re();for(const i of e)t.get(i.target)(i)}))})();const qe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((t,e)=>(t[e]=[],t)),{}),$e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Le=new Pe({whiteList:qe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if($e.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0),Be="http://www.w3.org/",Ge=Be+"2000/svg",Ve=Be+"1999/xlink";let He,Je=[],We=(t,e)=>{let i={};return Object.keys(t).forEach((e=>{i[e]=t[e]})),e&&Object.keys(e).forEach((t=>{i[t]=e[t]})),i},Ye=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Xe=t=>{if("string"!=typeof t)throw Error("Style values must be strings")},Ze=(t,e,i)=>{if(""!==e.vnodeSelector)for(let r=i;r<t.length;r++)if(Ye(t[r],e))return r;return-1},Ke=(t,e,i,r)=>{let s=t[e];if(""===s.vnodeSelector)return;let n=s.properties;if(!(n?void 0===n.key?n.bind:n.key:void 0))for(let n=0;n<t.length;n++)if(n!==e&&Ye(t[n],s))throw Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)},Qe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},ti=[],ei=!1,ii=t=>{(t.children||[]).forEach(ii),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.call(t.properties.bind||t.properties,t.domNode)},ri=()=>{ei=!1,ti.forEach(ii),ti.length=0},si=t=>{ti.push(t),ei||(ei=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(ri,{timeout:16}):setTimeout(ri,16))},ni=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i){e.style.pointerEvents="none";let r=()=>{e.parentNode&&(e.parentNode.removeChild(e),si(t))};return void i(e,r,t.properties)}}e.parentNode&&(e.parentNode.removeChild(e),si(t))},oi=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let n=s[o],a=e[n];if("className"===n)throw Error('Property "className" is not supported, use "class".');if("class"===n)hi(t,a,!0);else if("classes"===n){let e=Object.keys(a),i=e.length;for(let r=0;r<i;r++){let i=e[r];a[i]&&t.classList.add(i)}}else if("styles"===n){let e=Object.keys(a),r=e.length;for(let s=0;s<r;s++){let r=e[s],n=a[r];n&&(Xe(n),i.styleApplyer(t,r,n))}}else if("key"!==n&&null!=a){let s=typeof a;"function"===s?(0===n.lastIndexOf("on",0)&&(r&&(a=r(n,a,t,e)),"oninput"===n&&function(){let t=a;a=function(e){t.call(this,e),e.target["oninput-value"]=e.target.value}}()),t[n]=a):i.namespace===Ge?"href"===n?t.setAttributeNS(Ve,n,a):t.setAttribute(n,a):"string"===s&&"value"!==n?"innerHTML"===n?t[n]=Le.sanitize(a):t.setAttribute(n,a):t[n]=a}}},ai=(t,e,i)=>{((t,e,i)=>{if(e)for(let r of e)li(r,t,void 0,i)})(t,e.children,i),e.text&&(t.textContent=e.text),oi(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.call(e.properties.bind||e.properties,t,i,e.vnodeSelector,e.properties,e.children)},li=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(""===o)s=t.domNode=a.createTextNode(t.text),void 0!==i?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let h=o.charAt(l);if(l===o.length||"."===h||"#"===h){let h=o.charAt(n-1),u=o.slice(n,l);"."===h?s.classList.add(u):"#"===h?s.id=u:("svg"===u&&(r=We(r,{namespace:Ge})),void 0!==r.namespace?s=t.domNode=a.createElementNS(r.namespace,u):(s=t.domNode=t.domNode||a.createElement(u),"input"===u&&t.properties&&void 0!==t.properties.type&&s.setAttribute("type",t.properties.type)),void 0!==i?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}ai(s,t,r)}},hi=(t,e,i)=>{e&&e.split(" ").forEach((e=>{e&&t.classList.toggle(e,i)}))};He=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(""===e.vnodeSelector){if(e.text!==t.text){let t=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(t,r),e.domNode=t,s=!0,s}e.domNode=r}else 0===e.vnodeSelector.lastIndexOf("svg",0)&&(i=We(i,{namespace:Ge})),t.text!==e.text&&(n=!0,void 0===e.text?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=((t,e,i,r,s)=>{if(i===r)return!1;let n,o=(i=i||Je).length,a=(r=r||Je).length,l=0,h=0,u=!1;for(;h<a;){let a=l<o?i[l]:void 0,c=r[h];if(void 0!==a&&Ye(a,c))u=He(a,c,s)||u,l++;else{let a=Ze(i,c,l+1);if(a>=0){for(n=l;n<a;n++)ni(i[n]),Ke(i,n,t,"removed");u=He(i[a],c,s)||u,l=a+1}else li(c,e,l<o?i[l].domNode:void 0,s),Qe(c),Ke(r,h,t,"added")}h++}if(o>l)for(n=l;n<o;n++)ni(i[n]),Ke(i,n,t,"removed");return u})(e,r,t.children,e.children,i)||n,n=((t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let o=n[a],l=i[o],h=e[o];if("class"===o)h!==l&&(hi(t,h,!1),hi(t,l,!0));else if("classes"===o){let e=t.classList,i=Object.keys(l),r=i.length;for(let t=0;t<r;t++){let r=i[t],n=!!l[r];n!==!!h[r]&&(s=!0,n?e.add(r):e.remove(r))}}else if("styles"===o){let e=Object.keys(l),i=e.length;for(let n=0;n<i;n++){let i=e[n],o=l[i];o!==h[i]&&(s=!0,o?(Xe(o),r.styleApplyer(t,i,o)):r.styleApplyer(t,i,""))}}else if(l||"string"!=typeof h||(l=""),"value"===o){let e=t[o];e!==l&&(t["oninput-value"]?e===t["oninput-value"]:l!==h)&&(t[o]=l,t["oninput-value"]=void 0),l!==h&&(s=!0)}else if(l!==h){let e=typeof l;"function"===e&&r.eventHandlerInterceptor||(r.namespace===Ge?"href"===o?t.setAttributeNS(Ve,o,l):t.setAttribute(o,l):"string"===e?"innerHTML"===o?t[o]=Le.sanitize(l):"role"===o&&""===l?t.removeAttribute(o):t.setAttribute(o,l):t[o]!==l&&(t[o]=l),s=!0)}}return s})(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.call(e.properties.bind||e.properties,r,i,e.vnodeSelector,e.properties,e.children);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let ui=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,He(r,i,e)},domNode:t.domNode});const ci={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{"-"===e.charAt(0)?t.style.setProperty(e,i):t.style[e]=i}};let di=t=>We(ci,t),fi=(t,e,i)=>(i=di(i),li(e,t,void 0,i),ui(e,i)),pi=(t,e,i)=>(i=di(i),li(e,t.parentNode,t,i),ui(e,i)),gi=(t,e,i)=>(i=di(i),e.domNode=t,ai(t,e,i),ui(e,i)),mi=(t,e,i)=>(i=di(i),li(e,t.parentNode,t,i),t.parentNode.removeChild(t),ui(e,i));const vi={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties["on"+r.type].call(e.properties.bind||i,r))},wi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},bi=(t,e,i=!1)=>{let r=t;return e.forEach(((t,s)=>{var n;const o=null!=(n=r)&&n.children?((t,e)=>t.find(e))(r.children,(e=>e.domNode===t)):void 0;i&&!o&&s!==e.length-1||(r=o)})),r};let yi;yi="components/assets";const ki=Symbol("widget"),xi=[],Si={},_i=new WeakMap;function Ai(t,e){let i=e.children;if(i&&i.length)for(let e=0;e<i.length;++e)i[e]=Ai(t,i[e]);else i=xi;const r=e.vnodeSelector;if(Ti(r)){const s=e.properties||Si,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:Ii,afterUpdate:Oi,afterRemoved:ji,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function Ii(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=t,_i.set(t,o),null==o.afterCreate||o.afterCreate(o,t),r._internalHandles.add(y((()=>ji(t))))}function Oi(t,e,i,{widgetProperties:r}){const s=_i.get(t);s&&(s.set(r),null==s.afterUpdate||s.afterUpdate(s,t))}function ji(t){const e=_i.get(t);e&&(e.destroy(),_i.delete(t))}function Ti(t){return"function"==typeof t&&t[ki]}const Ei="esri.widgets.Widget",Ui=b.getLogger(Ei);let Ni=0;function zi(t,e){for(const i in e)null!=t[i]&&("object"==typeof t[i]&&"object"==typeof e[i]?zi(t[i],e[i]):t[i]=e[i]);return t}const Pi=(t=>{let e;const i={...vi,...t},r=(t=>({...wi,...t}))(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],h=[],u=(t,n,o)=>{let a;r.eventHandlerInterceptor=()=>function(t){let r;s("domEvent",t);const n=((t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i})(t.currentTarget,a.domNode),o=n.some((t=>{var e;return customElements.get(null==t||null==(e=t.tagName)?void 0:e.toLowerCase())}));if(t.eventPhase!==Event.CAPTURING_PHASE&&o){const e=t.composedPath(),i=e.slice(e.indexOf(t.currentTarget),e.indexOf(a.domNode)).filter((t=>t.getRootNode()===t.ownerDocument)).reverse();r=bi(a.getLastRender(),i,!0)}else n.reverse(),r=bi(a.getLastRender(),n);let l;return r&&(l=i.handleInterceptedEvent(e,r,this,t)),s("domEventProcessed",t),l},null==i.postProcessProjectionOptions||i.postProcessProjectionOptions(r);const u=o();a=t(n,u,r),l.push(a),h.push(o),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(a,u)};let c=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let t=0;t<l.length;t++){const e=h[t]();s("rendered",void 0),l[t].update(e),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(c=i.modifyDoRenderImplementation(c,l,h)),e={renderNow:c,scheduleRender:()=>{n||a||(n=requestAnimationFrame(c))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(t,e)=>{u(fi,t,e)},insertBefore:(t,e)=>{u(pi,t,e)},merge:(t,e)=>{u(gi,t,e)},replace:(t,e)=>{u(mi,t,e)},detach:t=>{for(let e=0;e<h.length;e++)if(h[e]===t)return h.splice(e,1),l.splice(e,1)[0];throw Error("renderFunction was not found")}},e})({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(t,r,s,n)=>{const o=e(t,r,s,n),a=i.test(t);if(!((t=t.replace(i,"")).toLowerCase()in s)||a){const e=t[2].toLowerCase()+t.slice(3),i=t=>o.call(s,t);s.addEventListener(e,i,a);const r=()=>s.removeEventListener(e,i,a),l=n.afterRemoved;n.afterRemoved=t=>{null==l||l(t),r()}}return o}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(Re(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let Ci=!1,Ri=class extends(_t(it.EventedAccessor)){constructor(t,e){super(t,e),this._attached=!1,this._internalHandles=new kt,this._projector=Pi,this._readyForTrueRender=!1,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=S((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const t=await U(this._messageBundleProps.map((async({bundlePath:t,propertyName:e})=>{let i=await N(t);this.uiStrings&&Object.keys(this.uiStrings)&&(i=zi(u(i),this.uiStrings)),this[e]=i})));for(const e of t)e.error&&Ui.error("widget-intl:locale-error",this.declaredClass,e.error)}await this.loadLocale()})),k(x("components/assets"));const i=getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")||"light";["light","dark"].includes(i)||_(Ui,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const r="esri-widget-uid-"+function(){const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=e=>t[e].toString(16);return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}
/*!
 * @esri/arcgis-html-sanitizer - v2.9.0 - Mon Dec 13 2021 15:07:01 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */(),s=this.render.bind(this);this._trackingTarget=new A((()=>this.scheduleRender()));const n=()=>{var t;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const e=s();let{properties:i}=e;i||(e.properties=i={});let{key:n,styles:o}=i;n||(i.key=r),o||(i.styles=o={}),o.display||(o.display="");let a=0;return null==(t=e.children)||t.forEach((t=>{if(Ti(t.vnodeSelector))return;let{properties:e}=t;e||(t.properties=e={}),e.key||(e.key=`${this.id}--${a++}`)})),Ai(this,e)};this.render=()=>{if(Ci)return n();let t=function(t){return Ce.get(t)}(this);if(t)return t;this._trackingTarget.clear(),Ci=!0;try{t=I(this._trackingTarget,n)}finally{Ci=!1}return function(t,e){Ce.set(t,e)}(this,t),t},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{this._readyForTrueRender=!0,this._postInitialize()})))}normalizeCtorArgs(t,e){const i={...t};return e&&(i.container=e),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then((()=>{})).catch(O)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget=j(this._trackingTarget),this.viewModel=j(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,De(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return function(t){return"string"==typeof t?document.getElementById(t):t}(t)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Ni++}set id(t){t&&this._set("id",t)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw Error("not implemented")}scheduleRender(){this.destroyed||(De(this),this._projector.scheduleRender())}classes(...t){return Fe.apply(this,t)}own(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments)),this._internalHandles.add(t)}renderNow(){De(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(It((()=>this.viewModel),((t,e)=>{e&&this._internalHandles.remove("delegated-events"),t&&this._internalHandles.add(this._delegatedEventNames.map((e=>t.on(e,(t=>{this.emit(e,t)})))),"delegated-events")}),Ut)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(O),this.scheduleRender()};this._internalHandles.add([T(e),It((()=>this.uiStrings),e),Ot((()=>this.container),(t=>{this.destroyed||this._attach(t)}),{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){t&&this._attached&&(this._projector.detach(this.render),t.parentNode&&t.parentNode.removeChild(t),this._attached=!1)}};Ri[ki]=!0,t([l()],Ri.prototype,"_readyForTrueRender",void 0),t([l({value:null})],Ri.prototype,"container",null),t([E("container")],Ri.prototype,"castContainer",null),t([l({aliasOf:"container"})],Ri.prototype,"domNode",void 0),t([l()],Ri.prototype,"iconClass",void 0),t([l()],Ri.prototype,"id",null),t([l()],Ri.prototype,"label",void 0),t([l()],Ri.prototype,"renderable",null),t([l()],Ri.prototype,"uiStrings",void 0),t([l()],Ri.prototype,"viewModel",void 0),t([l()],Ri.prototype,"visible",void 0),t([l()],Ri.prototype,"key",void 0),t([l()],Ri.prototype,"children",void 0),t([l()],Ri.prototype,"afterCreate",void 0),t([l()],Ri.prototype,"afterUpdate",void 0),t([l()],Ri.prototype,"afterRemoved",void 0),Ri=t([e(Ei)],Ri);const Di=Ri;function Fi(t){return function(e,i){e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Mi=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:""+t,domNode:null}},qi=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?qi(s,e):null!=s&&!1!==s&&(s.hasOwnProperty("vnodeSelector")||(s=Mi(s)),e.push(s))}},$i=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return qi(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Li(t,e,...i){return"function"!=typeof t||Ti(t)?$i(t,e,...i):t(e,...i)}const Bi="esri-identity-form__group",Gi="esri-identity-form__label";let Vi=class extends Di{constructor(t,e){super(t,e),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:t,server:e,resource:i,signingIn:r,oAuthPrompt:s,messages:n}=this,o=Li("div",{class:Bi},z(s?n.oAuthInfo:n.info,{server:/\.arcgis\.com/i.test(e)?"ArcGIS Online":e,resource:`(${i||n.lblItem})`})),a=s?null:Li("div",{class:Bi,key:"username"},Li("label",{class:Gi},n.lblUser,Li("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:Me,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),l=s?null:Li("div",{class:Bi,key:"password"},Li("label",{class:Gi},n.lblPwd,Li("input",{value:"",required:!0,type:"password",bind:this,afterCreate:Me,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),h=Li("div",{class:this.classes(Bi,"esri-identity-form__footer")},Li("input",{type:"submit",disabled:!!r,value:r?n.lblSigning:n.lblOk,class:"esri-button"}),Li("input",{type:"button",value:n.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),u=t?Li("div",null,t.details&&t.details.httpStatus?n.invalidUser:n.noAuthService):null;return Li("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},o,u,a,l,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(t){t.preventDefault(),this._set("signingIn",!0),this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})}};t([l(),Fi("esri/identity/t9n/identity")],Vi.prototype,"messages",void 0),t([l()],Vi.prototype,"signingIn",void 0),t([l()],Vi.prototype,"server",void 0),t([l()],Vi.prototype,"resource",void 0),t([l()],Vi.prototype,"error",void 0),t([l()],Vi.prototype,"oAuthPrompt",void 0),Vi=t([e("esri.identity.IdentityForm")],Vi);const Hi=Vi;
/*!
* tabbable 5.3.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/
var Ji=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Wi=Ji.join(","),Yi="undefined"==typeof Element,Xi=Yi?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Zi=!Yi&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},Ki=function(t,e,i){var r=Array.prototype.slice.apply(t.querySelectorAll(Wi));return e&&Xi.call(t,Wi)&&r.unshift(t),r.filter(i)},Qi=function t(e,i,r){for(var s=[],n=Array.from(e);n.length;){var o=n.shift();if("SLOT"===o.tagName){var a=o.assignedElements(),l=t(a.length?a:o.children,!0,r);r.flatten?s.push.apply(s,l):s.push({scope:o,candidates:l})}else{Xi.call(o,Wi)&&r.filter(o)&&(i||!e.includes(o))&&s.push(o);var h=o.shadowRoot||"function"==typeof r.getShadowRoot&&r.getShadowRoot(o);if(h){var u=t(!0===h?o.children:h.children,!0,r);r.flatten?s.push.apply(s,u):s.push({scope:o,candidates:u})}else n.unshift.apply(n,o.children)}}return s},tr=function(t,e){return t.tabIndex<0&&(e||/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||t.isContentEditable)&&isNaN(parseInt(t.getAttribute("tabindex"),10))?0:t.tabIndex},er=function(t,e){return t.tabIndex===e.tabIndex?t.documentOrder-e.documentOrder:t.tabIndex-e.tabIndex},ir=function(t){return"INPUT"===t.tagName},rr=function(t){var e=t.getBoundingClientRect();return 0===e.width&&0===e.height},sr=function(t,e){return!(e.disabled||function(t){return ir(t)&&"hidden"===t.type}(e)||function(t,e){var i=e.displayCheck,r=e.getShadowRoot;if("hidden"===getComputedStyle(t).visibility)return!0;var s=Xi.call(t,"details>summary:first-of-type");if(Xi.call(s?t.parentElement:t,"details:not([open]) *"))return!0;var n=Zi(t).host,o=(null==n?void 0:n.ownerDocument.contains(n))||t.ownerDocument.contains(t);if(i&&"full"!==i){if("non-zero-area"===i)return rr(t)}else{if("function"==typeof r){for(var a=t;t;){var l=t.parentElement,h=Zi(t);if(l&&!l.shadowRoot&&!0===r(l))return rr(t);t=t.assignedSlot?t.assignedSlot:l||h===t.ownerDocument?l:h.host}t=a}if(o)return!t.getClientRects().length}return!1}(e,t)||function(t){return"DETAILS"===t.tagName&&Array.prototype.slice.apply(t.children).some((function(t){return"SUMMARY"===t.tagName}))}(e)||function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var e=t.parentElement;e;){if("FIELDSET"===e.tagName&&e.disabled){for(var i=0;i<e.children.length;i++){var r=e.children.item(i);if("LEGEND"===r.tagName)return!!Xi.call(e,"fieldset[disabled] *")||!r.contains(t)}return!0}e=e.parentElement}return!1}(e))},nr=function(t,e){return!(function(t){return function(t){return ir(t)&&"radio"===t.type}(t)&&!function(t){if(!t.name)return!0;var e,i=t.form||Zi(t),r=function(t){return i.querySelectorAll('input[type="radio"][name="'+t+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)e=r(window.CSS.escape(t.name));else try{e=r(t.name)}catch(t){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",t.message),!1}var s=function(t,e){for(var i=0;i<t.length;i++)if(t[i].checked&&t[i].form===e)return t[i]}(e,t.form);return!s||s===t}(t)}(e)||tr(e)<0||!sr(t,e))},or=function t(e){var i=[],r=[];return e.forEach((function(e,s){var n=!!e.scope,o=n?e.scope:e,a=tr(o,n),l=n?t(e.candidates):o;0===a?n?i.push.apply(i,l):i.push(o):r.push({documentOrder:s,tabIndex:a,item:e,isScope:n,content:l})})),r.sort(er).reduce((function(t,e){return e.isScope?t.push.apply(t,e.content):t.push(e.content),t}),[]).concat(i)},ar=function(t,e){var i;return i=(e=e||{}).getShadowRoot?Qi([t],e.includeContainer,{filter:nr.bind(null,e),flatten:!1,getShadowRoot:e.getShadowRoot}):Ki(t,e.includeContainer,nr.bind(null,e)),or(i)},lr=function(t,e){if(e=e||{},!t)throw Error("No node provided");return!1!==Xi.call(t,Wi)&&nr(e,t)},hr=Ji.concat("iframe").join(","),ur=function(t,e){if(e=e||{},!t)throw Error("No node provided");return!1!==Xi.call(t,hr)&&sr(e,t)};
/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/
function cr(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function dr(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var fr=function(){var t=[];return{activateTrap:function(e){if(t.length>0){var i=t[t.length-1];i!==e&&i.pause()}var r=t.indexOf(e);-1===r||t.splice(r,1),t.push(e)},deactivateTrap:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1),t.length>0&&t[t.length-1].unpause()}}}(),pr=function(t){return setTimeout(t,0)},gr=function(t,e){var i=-1;return t.every((function(t,r){return!e(t)||(i=r,!1)})),i},mr=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return"function"==typeof t?t.apply(void 0,i):t},vr=function(t){return t.target.shadowRoot&&"function"==typeof t.composedPath?t.composedPath()[0]:t.target};const wr="esri-identity-modal__content";let br=class extends Di{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch("open",(()=>this._toggleFocusTrap())))}destroy(){this._destroyFocusTrap()}render(){const t=this.id,{open:e,content:i,title:r,messages:s}=this,n=e&&!!i,o={"esri-identity-modal--open":n,"esri-identity-modal--closed":!n},a=Li("button",{class:"esri-identity-modal__close-button","aria-label":s.close,title:s.close,bind:this,onclick:this._close},Li("span",{"aria-hidden":"true",class:"esri-icon-close"})),l=t+"_title",h=t+"_content",u=r?Li("h1",{id:l,class:"esri-identity-modal__title"},r):null,c=n?Li("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":l,"aria-describedby":h,afterCreate:this._createFocusTrap},a,u,this._renderContent(h)):null;return Li("div",{tabIndex:-1,class:this.classes("esri-identity-modal",o)},c)}_destroyFocusTrap(){var t;null==(t=this._focusTrap)||t.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap();const e=requestAnimationFrame((()=>{this._focusTrap=function(t,e){var i,r=(null==e?void 0:e.document)||document,s=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?cr(Object(i),!0).forEach((function(e){dr(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):cr(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},e),n={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},o=function(t,e,i){return t&&void 0!==t[e]?t[e]:s[i||e]},a=function(t){return!(!t||!n.containers.some((function(e){return e.contains(t)})))},l=function(t){var e=s[t];if("function"==typeof e){for(var i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];e=e.apply(void 0,n)}if(!e){if(void 0===e||!1===e)return e;throw Error("`".concat(t,"` was specified but was not a node, or did not return a node"))}var a=e;if("string"==typeof e&&!(a=r.querySelector(e)))throw Error("`".concat(t,"` as selector refers to no known node"));return a},h=function(){var t=l("initialFocus");if(!1===t)return!1;if(void 0===t)if(a(r.activeElement))t=r.activeElement;else{var e=n.tabbableGroups[0];t=e&&e.firstTabbableNode||l("fallbackFocus")}if(!t)throw Error("Your focus-trap needs to have at least one focusable element");return t},u=function(){if(n.tabbableGroups=n.containers.map((function(t){var e=ar(t),i=function(t,e){return(e=e||{}).getShadowRoot?Qi([t],e.includeContainer,{filter:sr.bind(null,e),flatten:!0,getShadowRoot:e.getShadowRoot}):Ki(t,e.includeContainer,sr.bind(null,e))}(t);if(e.length>0)return{container:t,firstTabbableNode:e[0],lastTabbableNode:e[e.length-1],nextTabbableNode:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=i.findIndex((function(e){return e===t}));return e?i.slice(r+1).find((function(t){return lr(t)})):i.slice(0,r).reverse().find((function(t){return lr(t)}))}}})).filter((function(t){return!!t})),n.tabbableGroups.length<=0&&!l("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},c=function t(e){!1!==e&&e!==r.activeElement&&(e&&e.focus?(e.focus({preventScroll:!!s.preventScroll}),n.mostRecentlyFocusedNode=e,function(t){return t.tagName&&"input"===t.tagName.toLowerCase()&&"function"==typeof t.select}(e)&&e.select()):t(h()))},d=function(t){var e=l("setReturnFocus",t);return e||!1!==e&&t},f=function(t){var e=vr(t);a(e)||(mr(s.clickOutsideDeactivates,t)?i.deactivate({returnFocus:s.returnFocusOnDeactivate&&!ur(e)}):mr(s.allowOutsideClick,t)||t.preventDefault())},p=function(t){var e=vr(t),i=a(e);i||e instanceof Document?i&&(n.mostRecentlyFocusedNode=e):(t.stopImmediatePropagation(),c(n.mostRecentlyFocusedNode||h()))},g=function(t){if(function(t){return"Escape"===t.key||"Esc"===t.key||27===t.keyCode}(t)&&!1!==mr(s.escapeDeactivates,t))return t.preventDefault(),void i.deactivate();(function(t){return"Tab"===t.key||9===t.keyCode})(t)&&function(t){var e=vr(t);u();var i=null;if(n.tabbableGroups.length>0){var r=gr(n.tabbableGroups,(function(t){return t.container.contains(e)})),s=r>=0?n.tabbableGroups[r]:void 0;if(r<0)i=t.shiftKey?n.tabbableGroups[n.tabbableGroups.length-1].lastTabbableNode:n.tabbableGroups[0].firstTabbableNode;else if(t.shiftKey){var o=gr(n.tabbableGroups,(function(t){return e===t.firstTabbableNode}));o<0&&(s.container===e||ur(e)&&!lr(e)&&!s.nextTabbableNode(e,!1))&&(o=r),o>=0&&(i=n.tabbableGroups[0===o?n.tabbableGroups.length-1:o-1].lastTabbableNode)}else{var a=gr(n.tabbableGroups,(function(t){return e===t.lastTabbableNode}));a<0&&(s.container===e||ur(e)&&!lr(e)&&!s.nextTabbableNode(e))&&(a=r),a>=0&&(i=n.tabbableGroups[a===n.tabbableGroups.length-1?0:a+1].firstTabbableNode)}}else i=l("fallbackFocus");i&&(t.preventDefault(),c(i))}(t)},m=function(t){if(!mr(s.clickOutsideDeactivates,t)){var e=vr(t);a(e)||mr(s.allowOutsideClick,t)||(t.preventDefault(),t.stopImmediatePropagation())}},v=function(){if(n.active)return fr.activateTrap(i),n.delayInitialFocusTimer=s.delayInitialFocus?pr((function(){c(h())})):c(h()),r.addEventListener("focusin",p,!0),r.addEventListener("mousedown",f,{capture:!0,passive:!1}),r.addEventListener("touchstart",f,{capture:!0,passive:!1}),r.addEventListener("click",m,{capture:!0,passive:!1}),r.addEventListener("keydown",g,{capture:!0,passive:!1}),i},w=function(){if(n.active)return r.removeEventListener("focusin",p,!0),r.removeEventListener("mousedown",f,!0),r.removeEventListener("touchstart",f,!0),r.removeEventListener("click",m,!0),r.removeEventListener("keydown",g,!0),i};return(i={activate:function(t){if(n.active)return this;var e=o(t,"onActivate"),i=o(t,"onPostActivate"),s=o(t,"checkCanFocusTrap");s||u(),n.active=!0,n.paused=!1,n.nodeFocusedBeforeActivation=r.activeElement,e&&e();var a=function(){s&&u(),v(),i&&i()};return s?(s(n.containers.concat()).then(a,a),this):(a(),this)},deactivate:function(t){if(!n.active)return this;clearTimeout(n.delayInitialFocusTimer),n.delayInitialFocusTimer=void 0,w(),n.active=!1,n.paused=!1,fr.deactivateTrap(i);var e=o(t,"onDeactivate"),r=o(t,"onPostDeactivate"),s=o(t,"checkCanReturnFocus");e&&e();var a=o(t,"returnFocus","returnFocusOnDeactivate"),l=function(){pr((function(){a&&c(d(n.nodeFocusedBeforeActivation)),r&&r()}))};return a&&s?(s(d(n.nodeFocusedBeforeActivation)).then(l,l),this):(l(),this)},pause:function(){return n.paused||!n.active||(n.paused=!0,w()),this},unpause:function(){return n.paused&&n.active?(n.paused=!1,u(),v(),this):this},updateContainerElements:function(t){var e=[].concat(t).filter(Boolean);return n.containers=e.map((function(t){return"string"==typeof t?r.querySelector(t):t})),n.active&&u(),this}}).updateContainerElements(t),i}(t,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()}));this.own(y((()=>cancelAnimationFrame(e))))}_renderContent(t){const e=this.content;return"string"==typeof e?Li("div",{class:wr,id:t,innerHTML:e}):function(t){return t&&"function"==typeof t.render}(e)?Li("div",{class:wr,id:t},e.render()):e instanceof HTMLElement?Li("div",{class:wr,id:t,bind:e,afterCreate:this._attachToNode}):null}_attachToNode(t){t.appendChild(this)}};t([l({readOnly:!0})],br.prototype,"container",void 0),t([l()],br.prototype,"content",void 0),t([l()],br.prototype,"open",void 0),t([l(),Fi("esri/t9n/common")],br.prototype,"messages",void 0),t([l({aliasOf:"messages.auth.signIn"})],br.prototype,"title",void 0),br=t([e("esri.identity.IdentityModal")],br);const yr=br,kr="esriJSAPIOAuth";class xr{constructor(t,e){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=e,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token))if(null==this.expires&&this.refreshToken)t=!0;else{const e=Date.now();this.expires>e&&(this.expires-e)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}return t}save(){if(!this.storage)return!1;const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let i=t[e.authNamespace];i||(i=t[e.authNamespace]={}),this.appId||(this.appId=e.appId),i[e.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(kr,JSON.stringify(t))}catch(t){return console.warn(t),!1}return!0}return!1}destroy(){const t=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&(null==this.expires||this.expires>Date.now())&&(this.refreshToken||this.token)){const t=e.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.refreshToken||this.token),i.append("client_id",e.appId),i.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(t,i);else{const e=new XMLHttpRequest;e.open("POST",t),e.send(i)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage){const i=t[e.authNamespace];if(i){delete i[e.portalUrl];try{this.storage.setItem(kr,JSON.stringify(t))}catch(t){console.log(t)}}}e&&(e._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let i=t[e.authNamespace];i&&(i=i[e.portalUrl],i&&(this.appId=i.appId,this.codeVerifier=i.codeVerifier,this.expires=i.expires,this.refreshToken=i.refreshToken,this.ssl=i.ssl,this.stateUID=i.stateUID,this.token=i.token,this.userId=i.userId))}}_load(){let t={};if(this.storage){const e=this.storage.getItem(kr);if(e)try{t=JSON.parse(e)}catch(t){console.warn(t)}}return t}}var Sr;xr.prototype.declaredClass="esri.identity.OAuthCredential";let _r=Sr=class extends P{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return Sr.fromJSON(this.toJSON())}};t([l({json:{write:!0}})],_r.prototype,"appId",void 0),t([l({json:{write:!0}})],_r.prototype,"authNamespace",void 0),t([l({json:{write:!0}})],_r.prototype,"expiration",void 0),t([l({json:{write:!0}})],_r.prototype,"flowType",void 0),t([l({json:{write:!0}})],_r.prototype,"forceLogin",void 0),t([l({json:{write:!0}})],_r.prototype,"forceUserId",void 0),t([l({json:{write:!0}})],_r.prototype,"locale",void 0),t([l({json:{write:!0}})],_r.prototype,"minTimeUntilExpiration",void 0),t([l({json:{write:!0}})],_r.prototype,"popup",void 0),t([l({json:{write:!0}})],_r.prototype,"popupCallbackUrl",void 0),t([l({json:{write:!0}})],_r.prototype,"popupWindowFeatures",void 0),t([l({json:{write:!0}})],_r.prototype,"portalUrl",void 0),t([l({json:{write:!0}})],_r.prototype,"preserveUrlHash",void 0),t([l({json:{write:!0}})],_r.prototype,"userId",void 0),_r=Sr=t([e("esri.identity.OAuthInfo")],_r);const Ar=_r;let Ir=class extends P{constructor(t){super(t),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};t([l({json:{write:!0}})],Ir.prototype,"adminTokenServiceUrl",void 0),t([l({json:{write:!0}})],Ir.prototype,"currentVersion",void 0),t([l({json:{write:!0}})],Ir.prototype,"hasPortal",void 0),t([l({json:{write:!0}})],Ir.prototype,"hasServer",void 0),t([l({json:{write:!0}})],Ir.prototype,"owningSystemUrl",void 0),t([l({json:{write:!0}})],Ir.prototype,"owningTenant",void 0),t([l({json:{write:!0}})],Ir.prototype,"server",void 0),t([l({json:{write:!0}})],Ir.prototype,"shortLivedTokenValidity",void 0),t([l({json:{write:!0}})],Ir.prototype,"tokenServiceUrl",void 0),t([l({json:{write:!0}})],Ir.prototype,"webTierAuth",void 0),Ir=t([e("esri.identity.ServerInfo")],Ir);const Or=Ir,jr={},Tr=t=>{const e=new D(t.owningSystemUrl).host,i=new D(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},Er=(t,e)=>!!(Tr(t)&&e&&e.some((e=>e.test(t.server))));let Ur=null,Nr=null;try{Ur=window.localStorage,Nr=window.sessionStorage}catch{}class zr extends it{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=Hi,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin="null"!==window.origin?window.origin:window.location.origin,this._appUrlObj=F(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener("pageshow",(t=>{this._pageShowHandler(t)}))}registerServers(t){const e=this.serverInfos;e?(t=t.filter((t=>!this.findServerInfo(t.server))),this.serverInfos=e.concat(t)):this.serverInfos=t,t.forEach((t=>{t.owningSystemUrl&&this._portals.push(t.owningSystemUrl),t.hasPortal&&this._portals.push(t.server)}))}registerOAuthInfos(t){const e=this.oAuthInfos;if(e){for(const i of t){const t=this.findOAuthInfo(i.portalUrl);t&&e.splice(e.indexOf(t),1)}this.oAuthInfos=e.concat(t)}else this.oAuthInfos=t}registerToken(t){t={...t};const e=this._sanitizeUrl(t.server),i=this._isServerRsrc(e);let r,s=this.findServerInfo(e),n=!0;s||(s=new Or,s.server=this._getServerInstanceRoot(e),i?s.hasServer=!0:(s.tokenServiceUrl=this._getTokenSvcUrl(e),s.hasPortal=!0),this.registerServers([s])),r=this._findCredential(e),r?(delete t.server,Object.assign(r,t),n=!1):(r=new Pr({userId:t.userId,server:s.server,token:t.token,expires:t.expires,ssl:t.ssl,scope:i?"server":"portal"}),r.resources=[e],this.credentials.push(r)),r.emitTokenChange(!1),n||r.refreshServerTokens()}toJSON(){return R({serverInfos:this.serverInfos.map((t=>t.toJSON())),oAuthInfos:this.oAuthInfos.map((t=>t.toJSON())),credentials:this.credentials.map((t=>t.toJSON()))})}initialize(t){if(!t)return;"string"==typeof t&&(t=JSON.parse(t));const e=t.serverInfos,i=t.oAuthInfos,r=t.credentials;if(e){const t=[];e.forEach((e=>{e.server&&e.tokenServiceUrl&&t.push(e.declaredClass?e:new Or(e))})),t.length&&this.registerServers(t)}if(i){const t=[];i.forEach((e=>{e.appId&&t.push(e.declaredClass?e:new Ar(e))})),t.length&&this.registerOAuthInfos(t)}r&&r.forEach((t=>{t.server&&t.token&&t.expires&&t.expires>Date.now()&&((t=t.declaredClass?t:new Pr(t)).emitTokenChange(),this.credentials.push(t))}))}findServerInfo(t){let e;t=this._sanitizeUrl(t);for(const i of this.serverInfos)if(this._hasSameServerInstance(i.server,t)){e=i;break}return e}findOAuthInfo(t){let e;t=this._sanitizeUrl(t);for(const i of this.oAuthInfos)if(this._hasSameServerInstance(i.portalUrl,t)){e=i;break}return e}findCredential(t,e){let i;t=this._sanitizeUrl(t);const r=this._isServerRsrc(t)?"server":"portal";if(e){for(const s of this.credentials)if(this._hasSameServerInstance(s.server,t)&&e===s.userId&&s.scope===r){i=s;break}}else for(const e of this.credentials)if(this._hasSameServerInstance(e.server,t)&&-1!==this._getIdenticalSvcIdx(t,e)&&e.scope===r){i=e;break}return i}getCredential(t,e){let i,r,s=!0;e&&(i=!!e.token,r=e.error,s=!1!==e.prompt),e={...e},t=this._sanitizeUrl(t);const n=new AbortController,o=M();if(e.signal&&q(e.signal,(()=>{n.abort()})),q(n,(()=>{o.reject(new $("identity-manager:user-aborted","ABORTED"))})),L(n))return o.promise;e.signal=n.signal;const a=this._isAdminResource(t),l=i?this.findCredential(t):null;let h;if(l&&r&&r.details&&498===r.details.httpStatus)l.destroy();else if(l)return h=new $("identity-manager:not-authorized","You are currently signed in as: '"+l.userId+"'. You do not have access to this resource: "+t,{error:r}),o.reject(h),o.promise;const u=this._findCredential(t,e);if(u)return o.resolve(u),o.promise;let c=this.findServerInfo(t);if(c)!c.hasServer&&this._isServerRsrc(t)&&(c._restInfoPms=this._getTokenSvcUrl(t),c.hasServer=!0);else{const e=this._getTokenSvcUrl(t);if(!e)return h=new $("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),o.reject(h),o.promise;c=new Or,c.server=this._getServerInstanceRoot(t),"string"==typeof e?(c.tokenServiceUrl=e,c.hasPortal=!0):(c._restInfoPms=e,c.hasServer=!0),this.registerServers([c])}return c.hasPortal&&void 0===c._selfReq&&(s||B(c.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((t=>t.tokenServiceUrl===c.tokenServiceUrl)))&&(c._selfReq={owningTenant:e&&e.owningTenant,selfDfd:this._getPortalSelf(c.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),t)}),this._enqueue(t,c,e,o,a)}getResourceName(t){return this._isRESTService(t)?t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(t)&&t.replace(this._gwUser,"$1")||this._gwItem.test(t)&&t.replace(this._gwItem,"$1")||this._gwGroup.test(t)&&t.replace(this._gwGroup,"$1")||""}generateToken(t,e,i){const r=this._rePortalTokenSvc.test(t.tokenServiceUrl),s=new D(this._appOrigin),n=t.shortLivedTokenValidity;let o,a,l,h,u,c,d,f;e&&(f=this.tokenValidity||n||this.defaultTokenValidity,f>n&&n>0&&(f=n)),i&&(o=i.isAdmin,a=i.serverUrl,l=i.token,c=i.signal,d=i.ssl,t.customParameters=i.customParameters),o?h=t.adminTokenServiceUrl:(h=t.tokenServiceUrl,u=new D(h.toLowerCase()),t.webTierAuth&&null!=i&&i.serverUrl&&!d&&"http"===s.scheme&&(B(s.uri,h,!0)||"https"===u.scheme&&s.host===u.host&&"7080"===s.port&&"7443"===u.port)&&(h=h.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const p={query:{request:"getToken",username:null==e?void 0:e.username,password:null==e?void 0:e.password,serverUrl:a,token:l,expiration:f,referer:o||r?this._appOrigin:null,client:o?"referer":null,f:"json",...t.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(t,i),signal:c,...null==i?void 0:i.ioArgs};return r||(p.withCredentials=!1),G(h,p).then((i=>{const r=i.data;if(!r||!r.token)return new $("identity-manager:authentication-failed","Unable to generate token");const s=t.server;return jr[s]||(jr[s]={}),e&&(jr[s][e.username]=e.password),r.validity=f,r}))}isBusy(){return!!this._busy}checkSignInStatus(t){return this.checkAppAccess(t,"").then((t=>t.credential))}checkAppAccess(t,e,i){let r=!1;return this.getCredential(t,{prompt:!1}).then((s=>{let n;const o={f:"json"};if("portal"===s.scope)if(e&&(this._doPortalSignIn(t)||i&&i.force))n=s.server+"/sharing/rest/oauth2/validateAppAccess",o.client_id=e;else{if(!s.token)return{credential:s};n=s.server+"/sharing/rest"}else{if(!s.token)return{credential:s};n=s.server+"/rest/services"}return s.token&&(o.token=s.token),G(n,{query:o,authMode:"anonymous"}).then((t=>{if(!1===t.data.valid)throw new $("identity-manager:not-authorized",`You are currently signed in as: '${s.userId}'.`,t.data);return r=!!t.data.viewOnlyUserTypeApp,{credential:s}})).catch((t=>{if("identity-manager:not-authorized"===t.name)throw t;const e=t.details&&t.details.httpStatus;if(498===e)throw s.destroy(),new $("identity-manager:not-authenticated","User is not signed in.");if(400===e)throw new $("identity-manager:invalid-request");return{credential:s}}))})).then((t=>({credential:t.credential,viewOnly:r})))}setOAuthResponseHash(t){t&&("#"===t.charAt(0)&&(t=t.substring(1)),this._processOAuthPopupParams(V(t)))}setOAuthRedirectionHandler(t){this._oAuthRedirectFunc=t}setProtocolErrorHandler(t){this._protocolFunc=t}signIn(t,e,i={}){const r=M(),s=()=>{var t,e,i,r,s;null==(t=a)||t.remove(),null==(e=l)||e.remove(),null==(i=h)||i.remove(),null==(r=o)||r.destroy(),null==(s=this.dialog)||s.destroy(),this.dialog=o=a=l=h=null},n=()=>{s(),this._oAuthDfd=null,r.reject(new $("identity-manager:user-aborted","ABORTED"))};i.signal&&q(i.signal,(()=>{n()}));let o=new this.formConstructor;o.resource=this.getResourceName(t),o.server=e.server,this.dialog=new yr,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");let a=o.on("cancel",n),l=this.dialog.watch("open",n),h=o.on("submit",(t=>{this.generateToken(e,t,{isAdmin:i.isAdmin,signal:i.signal}).then((n=>{s();const o=new Pr({userId:t.username,server:e.server,token:n.token,expires:null!=n.expires?Number(n.expires):null,ssl:!!n.ssl,isAdmin:i.isAdmin,validity:n.validity});r.resolve(o)})).catch((t=>{o.error=t,o.signingIn=!1}))}));return r.promise}oAuthSignIn(t,e,i,r){this._oAuthDfd=M();const s=this._oAuthDfd;let n;null!=r&&r.signal&&q(r.signal,(()=>{const t=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;t&&!t.closed?t.close():this.dialog&&c()})),s.resUrl_=t,s.sinfo_=e,s.oinfo_=i;const o=i._oAuthCred;if(o.storage&&("authorization-code"===i.flowType||"auto"===i.flowType&&!i.popup&&e.currentVersion>=8.4)){let t=crypto.getRandomValues(new Uint8Array(32));n=H(t),o.codeVerifier=n,t=crypto.getRandomValues(new Uint8Array(32)),o.stateUID=H(t),o.save()||(o.codeVerifier=n=null)}else o.codeVerifier=null;let a,l,h,u;this._getCodeChallenge(n).then((s=>{!i.popup||r&&!1===r.oAuthPopupConfirmation?this._doOAuthSignIn(t,e,i,s):(a=new this.formConstructor,a.oAuthPrompt=!0,a.server=e.server,this.dialog=new yr,this.dialog.content=a,this.dialog.open=!0,this.emit("dialog-create"),l=a.on("cancel",c),h=this.dialog.watch("open",c),u=a.on("submit",(()=>{d(),this._doOAuthSignIn(t,e,i,s)})))}));const c=()=>{d(),this._oAuthDfd=null,s.reject(new $("identity-manager:user-aborted","ABORTED"))},d=()=>{var t,e,i,r,s;null==(t=l)||t.remove(),null==(e=h)||e.remove(),null==(i=u)||i.remove(),null==(r=a)||r.destroy(),null==(s=this.dialog)||s.destroy(),this.dialog=null};return s.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach((t=>{t.destroy()})),this.emit("credentials-destroy")}enablePostMessageAuth(t="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=J(window,"message",(e=>{var i;if((e.origin===this._appOrigin||e.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(i=e.data)?void 0:i.type)){const i=e.source;this.getCredential(t).then((t=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:t.expires,server:t.server,ssl:t.ssl,token:t.token,userId:t.userId}},e.origin)})).catch((t=>{i.postMessage({type:"arcgis:auth:error",error:{name:t.name,message:t.message}},e.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let t=window.location.hash;if(t){"#"===t.charAt(0)&&(t=t.substring(1));const i=V(t);let r=!1;if(i.access_token&&i.expires_in&&i.state&&i.hasOwnProperty("username"))try{i.state=JSON.parse(i.state),i.state.portalUrl&&(this._oAuthLocationParams=i,r=!0)}catch{}else if(i.error&&i.error_description&&(console.log("IdentityManager OAuth Error: ",i.error," - ",i.error_description),"access_denied"===i.error&&(r=!0,i.state)))try{i.state=JSON.parse(i.state)}catch{}var e;r&&(window.location.hash=(null==(e=i.state)?void 0:e.hash)||"")}let i=window.location.search;if(i){"?"===i.charAt(0)&&(i=i.substring(1));const t=V(i);let e=!1;if(t.code&&t.state)try{t.state=JSON.parse(t.state),t.state.portalUrl&&t.state.uid&&(this._oAuthLocationParams=t,e=!0)}catch{}else if(t.error&&t.error_description&&(console.log("IdentityManager OAuth Error: ",t.error," - ",t.error_description),"access_denied"===t.error&&(e=!0,t.state)))try{t.state=JSON.parse(t.state)}catch{}if(e){var r;const e={...t};["code","error","error_description","message_code","persist","state"].forEach((t=>{delete e[t]}));const i=W(e),s=window.location.pathname+(i?"?"+i:"")+((null==(r=t.state)?void 0:r.hash)||"");window.history.replaceState(window.history.state,"",s)}}}_getOAuthToken(t,e,i,r,s){return t=t.replace(/^http:/i,"https:"),G(t+"/sharing/rest/oauth2/token",{authMode:"anonymous",method:"post",query:r&&s?{grant_type:"authorization_code",code:e,redirect_uri:r,client_id:i,code_verifier:s}:{grant_type:"refresh_token",refresh_token:e,client_id:i}}).then((t=>t.data))}_getCodeChallenge(t){if(t&&globalThis.isSecureContext){const e=(new TextEncoder).encode(t);return crypto.subtle.digest("SHA-256",e).then((t=>H(new Uint8Array(t))))}return Promise.resolve(null)}_pageShowHandler(t){if(t.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const t=new $("identity-manager:user-aborted","ABORTED");this._errbackFunc(t)}}_findCredential(t,e){let i,r,s,n,o=-1;const a=e&&e.token,l=e&&e.resource,h=this._isServerRsrc(t)?"server":"portal",u=this.credentials.filter((e=>this._hasSameServerInstance(e.server,t)&&e.scope===h));if(t=l||t,u.length)if(1===u.length){if(i=u[0],n=this.findServerInfo(i.server),r=n&&n.owningSystemUrl,s=r&&this.findCredential(r,i.userId),o=this._getIdenticalSvcIdx(t,i),!a)return-1===o&&i.resources.push(t),this._addResource(t,s),i;-1!==o&&(i.resources.splice(o,1),this._removeResource(t,s))}else{let e,i;if(u.some((a=>(i=this._getIdenticalSvcIdx(t,a),-1!==i&&(e=a,n=this.findServerInfo(e.server),r=n&&n.owningSystemUrl,s=r&&this.findCredential(r,e.userId),o=i,!0)))),a)e&&(e.resources.splice(o,1),this._removeResource(t,s));else if(e)return this._addResource(t,s),e}}_findOAuthInfo(t){let e=this.findOAuthInfo(t);if(!e)for(const i of this.oAuthInfos)if(this._isIdProvider(i.portalUrl,t)){e=i;break}return e}_addResource(t,e){e&&-1===this._getIdenticalSvcIdx(t,e)&&e.resources.push(t)}_removeResource(t,e){let i=-1;e&&(i=this._getIdenticalSvcIdx(t,e),i>-1&&e.resources.splice(i,1))}_useProxy(t,e){return e&&e.isAdmin&&!B(t.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(t.tokenServiceUrl)&&"10.1"==t.currentVersion+""&&!B(t.tokenServiceUrl,this._appOrigin)}_getOrigin(t){const e=new D(t);return e.scheme+"://"+e.host+(null!=e.port?":"+e.port:"")}_getServerInstanceRoot(t){const e=t.toLowerCase();let i=e.indexOf(this._agsRest);return-1===i&&this._isAdminResource(t)&&(i=this._agsAdmin.test(t)?t.replace(this._agsAdmin,"$1").length:t.search(this._adminSvcs)),-1===i&&(i=e.indexOf("/sharing")),-1===i&&"/"===e.substr(-1)&&(i=e.length-1),i>-1?t.substring(0,i):t}_hasSameServerInstance(t,e){return"/"===t.substr(-1)&&(t=t.slice(0,-1)),t=t.toLowerCase(),e=this._getServerInstanceRoot(e).toLowerCase(),t=this._normalizeAGOLorgDomain(t),e=this._normalizeAGOLorgDomain(e),(t=t.substr(t.indexOf(":")))===e.substr(e.indexOf(":"))}_normalizeAGOLorgDomain(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}_sanitizeUrl(t){const e=(Y.request.proxyUrl||"").toLowerCase(),i=e?t.toLowerCase().indexOf(e+"?"):-1;return-1!==i&&(t=t.substring(i+e.length+1)),t=X(t),F(t).path}_isRESTService(t){return t.indexOf(this._agsRest)>-1}_isAdminResource(t){return this._agsAdmin.test(t)||this._adminSvcs.test(t)}_isServerRsrc(t){return this._isRESTService(t)||this._isAdminResource(t)}_isIdenticalService(t,e){let i;if(this._isRESTService(t)&&this._isRESTService(e)){const r=this._getSuffix(t).toLowerCase(),s=this._getSuffix(e).toLowerCase();if(i=r===s,!i){const t=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;i=r.replace(t,"$1")===s.replace(t,"$1")}}else this._isAdminResource(t)&&this._isAdminResource(e)?i=!0:this._isServerRsrc(t)||this._isServerRsrc(e)||!this._isPortalDomain(t)||(i=!0);return i}_isPortalDomain(t){const e=new D(t.toLowerCase()),i=this._portalConfig;let r=this._gwDomains.some((t=>t.regex.test(e.uri)));return!r&&i&&(r=this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e.uri)),r||Y.portalUrl&&(r=B(e,Y.portalUrl,!0)),r||(r=this._portals.some((t=>this._hasSameServerInstance(t,e.uri)))),r=r||this._agsPortal.test(e.path),r}_isIdProvider(t,e){let i=-1,r=-1;this._gwDomains.forEach(((s,n)=>{-1===i&&s.regex.test(t)&&(i=n),-1===r&&s.regex.test(e)&&(r=n)}));let s=!1;if(i>-1&&r>-1&&(0===i||4===i?0!==r&&4!==r||(s=!0):1===i?1!==r&&2!==r||(s=!0):2===i?2===r&&(s=!0):3===i&&3===r&&(s=!0)),!s){const i=this.findServerInfo(e),r=i&&i.owningSystemUrl;r&&Tr(i)&&this._isPortalDomain(r)&&this._isIdProvider(t,r)&&(s=!0)}return s}_getIdenticalSvcIdx(t,e){let i=-1;for(let r=0;r<e.resources.length;r++)if(this._isIdenticalService(t,e.resources[r])){i=r;break}return i}_getSuffix(t){return t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(t){let e,i,r;if(this._isRESTService(t)||this._isAdminResource(t)){const r=this._getServerInstanceRoot(t);return e=r+"/admin/generateToken",i=G(t=r+"/rest/info",{query:{f:"json"}}).then((t=>t.data)),{adminUrl:e,promise:i}}if(this._isPortalDomain(t)){let e="";if(this._gwDomains.some((i=>(i.regex.test(t)&&(e=i.tokenServiceUrl),!!e))),e||this._portals.some((i=>(this._hasSameServerInstance(i,t)&&(e=i+this._gwTokenUrl),!!e))),e||(r=t.toLowerCase().indexOf("/sharing"),-1!==r&&(e=t.substring(0,r)+this._gwTokenUrl)),e||(e=this._getOrigin(t)+this._gwTokenUrl),e){const i=new D(t).port;/^http:\/\//i.test(t)&&"7080"===i&&(e=e.replace(/:7080/i,":7443")),e=e.replace(/http:/i,"https:")}return e}if(-1!==t.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_processOAuthResponseParams(t,e,i){const r=e._oAuthCred;if(t.code){const s=r.codeVerifier;return r.codeVerifier=null,r.stateUID=null,r.save(),this._getOAuthToken(i.server,t.code,e.appId,this._getRedirectURI(e,!0),s).then((s=>{const n=new Pr({userId:s.username,server:i.server,token:s.access_token,expires:Date.now()+1e3*s.expires_in,ssl:s.ssl,oAuthState:t.state,_oAuthCred:r});return e.userId=n.userId,r.storage=s.persist?Ur:Nr,r.refreshToken=s.refresh_token,r.token=null,r.expires=s.refresh_token_expires_in?Date.now()+1e3*s.refresh_token_expires_in:null,r.userId=n.userId,r.ssl=n.ssl,r.save(),n}))}const s=new Pr({userId:t.username,server:i.server,token:t.access_token,expires:Date.now()+1e3*Number(t.expires_in),ssl:"true"===t.ssl,oAuthState:t.state,_oAuthCred:r});return e.userId=s.userId,r.storage=t.persist?Ur:Nr,r.refreshToken=null,r.token=s.token,r.expires=s.expires,r.userId=s.userId,r.ssl=s.ssl,r.save(),Promise.resolve(s)}_processOAuthPopupParams(t){var e;const i=this._oAuthDfd;if(this._oAuthDfd=null,i)if(clearInterval(this._oAuthIntervalId),null==(e=this._oAuthOnPopupHandle)||e.remove(),t.error){const e="access_denied"===t.error,r=new $(e?"identity-manager:user-aborted":"identity-manager:authentication-failed",e?"ABORTED":"OAuth: "+t.error+" - "+t.error_description);i.reject(r)}else this._processOAuthResponseParams(t,i.oinfo_,i.sinfo_).then((t=>{i.resolve(t)})).catch((t=>{i.reject(t)}))}_setOAuthResponseQueryString(t){t&&("?"===t.charAt(0)&&(t=t.substring(1)),this._processOAuthPopupParams(V(t)))}_exchangeToken(t,e,i){return G(t+"/sharing/rest/oauth2/exchangeToken",{authMode:"anonymous",method:"post",query:{f:"json",client_id:e,token:i}}).then((t=>t.data.token))}_getPlatformSelf(t,e){return t=t.replace(/^http:/i,"https:"),G(t+"/sharing/rest/oauth2/platformSelf",{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":e,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0}).then((t=>t.data))}_getPortalSelf(t,e){let i;return this._gwDomains.some((e=>(e.regex.test(t)&&(i=e.customBaseUrl),!!i))),i?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:i,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?t=t.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(e)&&(t=t.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),G(t,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then((t=>t.data)))}_doPortalSignIn(t){const e=this._portalConfig,i=window.location.href,r=this.findServerInfo(t);return!(!e&&!this._isPortalDomain(i)||!(r?r.hasPortal||r.owningSystemUrl&&this._isPortalDomain(r.owningSystemUrl):this._isPortalDomain(t))||!(this._isIdProvider(i,t)||e&&(this._hasSameServerInstance(this._getServerInstanceRoot(e.restBaseUrl),t)||this._isIdProvider(e.restBaseUrl,t))||B(i,t,!0)))}_checkProtocol(t,e,i,r){let s=!0;const n=r?e.adminTokenServiceUrl:e.tokenServiceUrl;return n.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&Z(n)&&(s=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:t,serverInfo:e}),!s)&&i(new $("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),s}_enqueue(t,e,i,r,s,n){return r||(r=M()),r.resUrl_=t,r.sinfo_=e,r.options_=i,r.admin_=s,r.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(t),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(r)):this._xoReqs.push(r):this._doSignIn(r),r.promise}_doSignIn(t){this._busy=t,this._rejectOnPersistedPageShow=!1;const e=e=>{const i=t.options_&&t.options_.resource,r=t.resUrl_,s=t.refresh_;let n=!1;-1===this.credentials.indexOf(e)&&(s&&-1!==this.credentials.indexOf(s)?(s.userId=e.userId,s.token=e.token,s.expires=e.expires,s.validity=e.validity,s.ssl=e.ssl,s.creationTime=e.creationTime,n=!0,e=s):this.credentials.push(e)),e.resources||(e.resources=[]),e.resources.includes(i||r)||e.resources.push(i||r),e.scope=this._isServerRsrc(r)?"server":"portal",e.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((t=>{if(!this._isIdenticalService(r,t.resUrl_)){const i=this._getSuffix(t.resUrl_);a[i]||(a[i]=!0,e.resources.push(t.resUrl_))}})),t.resolve(e),o.forEach((t=>{this._hasSameServerInstance(this._getServerInstanceRoot(r),t.resUrl_)?t.resolve(e):this._soReqs.push(t)})),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,n||this.emit("credential-create",{credential:e}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=e=>{t.reject(e),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=(s,n,o,a)=>{var l,h;const u=t.sinfo_,c=!t.options_||!1!==t.options_.prompt,d=u.hasPortal&&this._findOAuthInfo(t.resUrl_);let f,p;if(s)e(new Pr({userId:s,server:u.server,token:o||null,expires:null!=a?Number(a):null,ssl:!!n}));else if(window!==window.parent&&null!=(l=this._appUrlObj.query)&&l["arcgis-auth-origin"]&&null!=(h=this._appUrlObj.query)&&h["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),t.resUrl_)){var g;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const r=J(window,"message",(t=>{t.source===window.parent&&t.data&&("arcgis:auth:credential"===t.data.type?(r.remove(),t.data.credential.expires<Date.now()?i(new $("identity-manager:credential-request-failed","Parent application's token has expired.")):e(new Pr(t.data.credential))):"arcgis:auth:error"===t.data.type&&(r.remove(),i("tokenExpiredError"===t.data.error.name?new $("identity-manager:credential-request-failed","Parent application's token has expired."):$.fromJSON(t.data.error))))}));q(null==(g=t.options_)?void 0:g.signal,(()=>{r.remove()}))}else if(d){let s=d._oAuthCred;if(!s){const t=new xr(d,Ur),e=new xr(d,Nr);t.isValid()&&e.isValid()?t.expires>e.expires?(s=t,e.destroy()):(s=e,t.destroy()):s=t.isValid()?t:e,d._oAuthCred=s}if(s.isValid()){f=new Pr({userId:s.userId,server:u.server,token:s.token,expires:s.expires,ssl:s.ssl,_oAuthCred:s});const i=d.appId!==s.appId&&this._doPortalSignIn(t.resUrl_);i||s.refreshToken?(t._pendingDfd=s.refreshToken?this._getOAuthToken(u.server,s.refreshToken,s.appId).then((t=>(f.expires=Date.now()+1e3*t.expires_in,f.token=t.access_token,f))):Promise.resolve(f),t._pendingDfd.then((t=>i?this._exchangeToken(t.server,d.appId,t.token).then((e=>(t.token=e,t))).catch((()=>t)):t)).then((t=>{e(t)})).catch((()=>{s.destroy(),r()}))):e(f)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(d.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===s.stateUID&&s.codeVerifier)){const r=this._oAuthLocationParams;this._oAuthLocationParams=null,t._pendingDfd=this._processOAuthResponseParams(r,d,u).then((t=>{e(t)})).catch(i)}else{const r=()=>{c?t._pendingDfd=this.oAuthSignIn(t.resUrl_,u,d,t.options_).then(e,i):(p=new $("identity-manager:not-authenticated","User is not signed in."),i(p))};this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._getPlatformSelf(u.server,d.appId).then((t=>{B(t.portalUrl,this._appOrigin,!0)?(f=new Pr({userId:t.username,server:u.server,expires:Date.now()+1e3*t.expires_in,token:t.token}),e(f)):r()})).catch(r):r()}}else if(c){if(this._checkProtocol(t.resUrl_,u,i,t.admin_)){let r=t.options_;t.admin_&&(r=r||{},r.isAdmin=!0),t._pendingDfd=this.signIn(t.resUrl_,u,r).then(e,i)}}else p=new $("identity-manager:not-authenticated","User is not signed in."),i(p)},s=()=>{const r=t.sinfo_,s=r.owningSystemUrl,n=t.options_;let o,a,l,h;if(n&&(o=n.token,a=n.error,l=n.prompt),h=this._findCredential(s,{token:o,resource:t.resUrl_}),!h)for(const t of this.credentials)if(this._isIdProvider(s,t.server)){h=t;break}if(h){const s=this.findCredential(t.resUrl_,h.userId);if(s)e(s);else if(Er(r,this._legacyFed)){const t=h.toJSON();t.server=r.server,t.resources=null,e(new Pr(t))}else(t._pendingDfd=this.generateToken(this.findServerInfo(h.server),null,{serverUrl:t.resUrl_,token:h.token,signal:t.options_.signal,ssl:h.ssl})).then((i=>{e(new Pr({userId:h.userId,server:r.server,token:i.token,expires:null!=i.expires?Number(i.expires):null,ssl:!!i.ssl,isAdmin:t.admin_,validity:i.validity}))}),i)}else this._busy=null,o&&(t.options_.token=null),(t._pendingDfd=this.getCredential(s.replace(/\/?$/,"/sharing"),{resource:t.resUrl_,owningTenant:r.owningTenant,signal:t.options_.signal,token:o,error:a,prompt:l})).then((()=>{this._enqueue(t.resUrl_,t.sinfo_,t.options_,t,t.admin_)}),(e=>{t.resUrl_=t.sinfo_=t.refresh_=null,t.reject(e)}))};this._errbackFunc=i;const n=t.sinfo_.owningSystemUrl,o=this._isServerRsrc(t.resUrl_),a=t.sinfo_._restInfoPms;a?a.promise.then((e=>{const i=t.sinfo_;if(i._restInfoPms){i.adminTokenServiceUrl=i._restInfoPms.adminUrl,i._restInfoPms=null,i.tokenServiceUrl=K("authInfo.tokenServicesUrl",e)||K("authInfo.tokenServiceUrl",e)||K("tokenServiceUrl",e),i.shortLivedTokenValidity=K("authInfo.shortLivedTokenValidity",e),i.currentVersion=e.currentVersion,i.owningTenant=e.owningTenant;const t=i.owningSystemUrl=e.owningSystemUrl;t&&this._portals.push(t)}o&&i.owningSystemUrl?s():r()}),(()=>{t.sinfo_._restInfoPms=null;const e=new $("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");i(e)})):o&&n?s():t.sinfo_._selfReq?t.sinfo_._selfReq.selfDfd.then((e=>{const i={};let r,s,n,o;return e&&(r=e.user&&e.user.username,i.username=r,i.allSSL=e.allSSL,s=e.supportsOAuth,n=parseFloat(e.currentVersion),"multitenant"===e.portalMode&&(o=e.customBaseUrl),t.sinfo_.currentVersion=n),t.sinfo_.webTierAuth=!!r,r&&this.normalizeWebTierAuth?this.generateToken(t.sinfo_,null,{ssl:i.allSSL}).catch((()=>null)).then((t=>(i.portalToken=t&&t.token,i.tokenExpiration=t&&t.expires,i))):!r&&s&&n>=4.4&&!this._findOAuthInfo(t.resUrl_)?this._generateOAuthInfo({portalUrl:t.sinfo_.server,customBaseUrl:o,owningTenant:t.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>i)):i})).catch((()=>null)).then((e=>{t.sinfo_._selfReq=null,e?r(e.username,e.allSSL,e.portalToken,e.tokenExpiration):r()})):r()}_generateOAuthInfo(t){let e,i,r=t.portalUrl;const s=t.customBaseUrl,n=t.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){i=window.location.href;let t=i.indexOf("?");t>-1&&(i=i.slice(0,t)),t=i.search(/\/(apps|home)\//),i=t>-1?i.slice(0,t):null}return o&&i?(this._hasTestedIfAppIsOnPortal=!0,e=G(i+"/sharing/rest",{query:{f:"json"}}).then((()=>{this.defaultOAuthInfo=new Ar({appId:"arcgisonline",popupCallbackUrl:i+"/home/oauth-callback.html"})}))):e=Promise.resolve(),e.then((()=>{if(this.defaultOAuthInfo)return r=r.replace(/^http:/i,"https:"),G(r+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:n,client_id:this.defaultOAuthInfo.appId,redirect_uri:k(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then((t=>{if(t.data.valid){const e=this.defaultOAuthInfo.clone();e.portalUrl=t.data.urlKey&&s?"https://"+t.data.urlKey.toLowerCase()+"."+s:r,e.popup=window!==window.top||!(B(r,this._appOrigin)||this._gwDomains.some((t=>t.regex.test(r)&&t.regex.test(this._appOrigin)))),this.oAuthInfos.push(e)}}))}))}_doOAuthSignIn(t,e,i,r){const s=i._oAuthCred,n={portalUrl:i.portalUrl};!i.popup&&i.preserveUrlHash&&window.location.hash&&(n.hash=window.location.hash),s.stateUID&&(n.uid=s.stateUID);const o={client_id:i.appId,response_type:s.codeVerifier?"code":"token",state:JSON.stringify(n),expiration:i.expiration,locale:i.locale,redirect_uri:this._getRedirectURI(i,!!s.codeVerifier)};i.forceLogin&&(o.force_login=!0),i.forceUserId&&i.userId&&(o.prepopulatedusername=i.userId),!i.popup&&this._doPortalSignIn(t)&&(o.redirectToUserOrgUrl=!0),s.codeVerifier&&(o.code_challenge=r||s.codeVerifier,o.code_challenge_method=r?"S256":"plain");const a=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",l=a+"?"+W(o);if(i.popup){const t=window.open(l,"esriJSAPIOAuth",i.popupWindowFeatures);if(t)t.focus(),this._oAuthDfd.oAuthWin_=t,this._oAuthIntervalId=setInterval((()=>{if(t.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const t=this._oAuthDfd;if(t){const e=new $("identity-manager:user-aborted","ABORTED");t.reject(e)}}}),500),this._oAuthOnPopupHandle=J(window,["arcgis:auth:hash","arcgis:auth:location:search"],(t=>{"arcgis:auth:hash"===t.type?this.setOAuthResponseHash(t.detail):this._setOAuthResponseQueryString(t.detail)}));else{const t=new $("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(t)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:o,authorizeUrl:a,resourceUrl:t,serverInfo:e,oAuthInfo:i}):window.location.href=l}_getRedirectURI(t,e){const i=window.location.href.replace(/#.*$/,"");if(t.popup)return k(t.popupCallbackUrl);if(e){const t=F(i);return t.query&&["code","error","error_description","message_code","persist","state"].forEach((e=>{delete t.query[e]})),Q(t.path,t.query)}return i}}zr.prototype.declaredClass="esri.identity.IdentityManagerBase";let Pr=class extends it.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t&&t._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const t=C.findServerInfo(this.server),e=t&&t.owningSystemUrl,i=!!e&&"server"===this.scope,r=i&&Er(t,C._legacyFed),s=t.webTierAuth,n=s&&C.normalizeWebTierAuth,o=jr[this.server],a=o&&o[this.userId];let l,h=this.resources&&this.resources[0],u=i&&C.findServerInfo(e),c={username:this.userId,password:a};if(s&&!n)return;i&&!u&&C.serverInfos.some((t=>(C._isIdProvider(e,t.server)&&(u=t),!!u)));const d=u&&C.findCredential(u.server,this.userId);if(!i||d){if(!r){if(i)l={serverUrl:h,token:d&&d.token,ssl:d&&d.ssl};else if(n)c=null,l={ssl:this.ssl};else{if(!a){let e;return h&&(h=C._sanitizeUrl(h),this._enqueued=1,e=C._enqueue(h,t,null,null,this.isAdmin,this),e.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),e}this.isAdmin&&(l={isAdmin:!0})}return C.generateToken(i?u:t,i?null:c,l).then((t=>{this.token=t.token,this.expires=null!=t.expires?Number(t.expires):null,this.creationTime=Date.now(),this.validity=t.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}d.refreshToken()}}refreshServerTokens(){"portal"===this.scope&&C.credentials.forEach((t=>{const e=C.findServerInfo(t.server),i=e&&e.owningSystemUrl;t!==this&&t.userId===this.userId&&i&&"server"===t.scope&&(C._hasSameServerInstance(this.server,i)||C._isIdProvider(i,this.server))&&(Er(e,C._legacyFed)?(t.token=this.token,t.expires=this.expires,t.creationTime=this.creationTime,t.validity=this.validity,t.emitTokenChange()):t.refreshToken())}))}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=this.server&&C.findServerInfo(this.server),i=e&&e.owningSystemUrl,r=i&&C.findServerInfo(i);!1===t||i&&"portal"!==this.scope&&(!r||!r.webTierAuth||C.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=C.credentials.indexOf(this);t>-1&&C.credentials.splice(t,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=R({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};t([l()],Pr.prototype,"creationTime",void 0),t([l()],Pr.prototype,"expires",void 0),t([l()],Pr.prototype,"isAdmin",void 0),t([l()],Pr.prototype,"oAuthState",void 0),t([l()],Pr.prototype,"resources",void 0),t([l()],Pr.prototype,"scope",void 0),t([l()],Pr.prototype,"server",void 0),t([l()],Pr.prototype,"ssl",void 0),t([l()],Pr.prototype,"token",void 0),t([l()],Pr.prototype,"tokenRefreshBuffer",void 0),t([l()],Pr.prototype,"userId",void 0),t([l()],Pr.prototype,"validity",void 0),Pr=t([e("esri.identity.Credential")],Pr);class Cr extends zr{}Cr.prototype.declaredClass="esri.identity.IdentityManager";const Rr=new Cr;tt(Rr);export default Rr;