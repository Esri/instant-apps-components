import{b as t,i as e,r as i,p as r,c as n,d as s,f as o,N as a,g as l,h,l as c,q as u,k as d,t as f,T as p,n as g,o as m,u as v,w as b,x as w,y,z as k,A as x,B as S,C as A,D as j,E as I,F as _,G as O,H as T,I as E,J as z,K as C,L as N,O as U,P,Q as D,R,S as F,s as $,U as q,V as M,W as L,X as B,Y as G,Z as H,_ as V,$ as J,a0 as W,a1 as Y,a2 as X}from"./p-166186dc.js";import"./p-e510b9d9.js";class Z{constructor(){this._emitter=new Z.EventEmitter(this)}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}}!function(n){class s{constructor(t=null){this.target=t,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(t,e){const i=this._listenersMap&&this._listenersMap.get(t);if(!i)return!1;const r=this.target||this;return[...i].forEach((t=>{t.call(r,e)})),i.length>0}on(t,e){if(Array.isArray(t)){const r=t.map((t=>this.on(t,e)));return i(r)}if(t.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const r=this._listenersMap.get(t)||[];return r.push(e),this._listenersMap.set(t,r),{remove:()=>{const i=this._listenersMap&&this._listenersMap.get(t)||[],r=i.indexOf(e);r>=0&&i.splice(r,1)}}}once(t,e){const i=this.on(t,(t=>{i.remove(),e.call(null,t)}));return i}hasEventListener(t){const e=this._listenersMap&&this._listenersMap.get(t);return null!=e&&e.length>0}}n.EventEmitter=s,n.EventedMixin=i=>{let r=class extends i{constructor(){super(...arguments),this._emitter=new s}destroy(){this._emitter.clear()}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}};return r=t([e("esri.core.Evented")],r),r};let o=class extends r{constructor(){super(...arguments),this._emitter=new Z.EventEmitter(this)}destroy(){this._emitter.clear()}emit(t,e){return this._emitter.emit(t,e)}on(t,e){return this._emitter.on(t,e)}once(t,e){return this._emitter.once(t,e)}hasEventListener(t){return this._emitter.hasEventListener(t)}};o=t([e("esri.core.Evented")],o),n.EventedAccessor=o}(Z||(Z={}));const K=Z;function Q(t){return(e,i)=>{e[i]=t}}class tt{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new n(this._observers,t)}notify(){const t=this._observers.slice();for(let e=0;e<t.length;++e){const i=t[e];i.onInvalidated(),i.onCommitted()}}}var et;const it=new s(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}},void 0,(t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1})),rt=()=>{};function nt(t){return t?t instanceof ft?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function st(t){if(t&&t.length)return t[0]}function ot(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function at(t,e,i,r){e&&e.forEach(((e,n,s)=>{t.push(e),at(t,i.call(r,e,n,s),i,r)}))}const lt=new Set,ht=new Set,ct=new Set,ut=new Map;let dt=0,ft=et=class extends K.EventedAccessor{constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new tt,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:dt++})}static isCollection(t){return null!=t&&t instanceof et}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof et?{items:t}:t:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return h(this._observable),this._items}set items(t){this._emitBeforeChanges(1)||(this._splice(0,this.length,nt(t)),this._emitAfterChanges(1))}hasEventListener(t){return"change"===t?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if("change"===t){const t=this._chgListeners,i={removed:!1,callback:e};return t.push(i),this._notifications&&this._notifications.push({listeners:t.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=rt,i.removed=!0,t.splice(t.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(h(this._observable),this._emitBeforeChanges(1))return this;const i=this.getNextIndex(null!=e?e:null);return this._splice(i,0,[t]),this._emitAfterChanges(1),this}addMany(t,e=this._items.length){if(h(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(1))return this;const i=this.getNextIndex(e);return this._splice(i,0,nt(t)),this._emitAfterChanges(1),this}removeAll(){if(h(this._observable),!this.length||this._emitBeforeChanges(2))return[];const t=this._splice(0,this.length)||[];return this._emitAfterChanges(2),t}clone(){return h(this._observable),this._createNewInstance({items:this._items.map(c)})}concat(...t){h(this._observable);const e=t.map(nt);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(h(this._observable),!this.length||this._emitBeforeChanges(2))return;const i=u(this._splice(0,this.length)),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(2)}every(t,e){return h(this._observable),this._items.every(t,e)}filter(t,e){let i;return h(this._observable),i=2===arguments.length?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return h(this._observable),this._items.find(t,e)}findIndex(t,e){return h(this._observable),this._items.findIndex(t,e)}flatten(t,e){h(this._observable);const i=[];return at(i,this,t,e),new et(i)}forEach(t,e){return h(this._observable),this._items.forEach(t,e)}getItemAt(t){return h(this._observable),this._items[t]}getNextIndex(t){h(this._observable);const e=this.length;return(t=null==t?e:t)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return h(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return h(this._observable),this._items.indexOf(t,e)}join(t=","){return h(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return h(this._observable),this._items.lastIndexOf(t,e)}map(t,e){h(this._observable);const i=this._items.map(t,e);return new et({items:i})}reorder(t,e=this.length-1){h(this._observable);const i=this.indexOf(t);if(-1!==i){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(4))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(4)}return t}}pop(){if(h(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=st(this._splice(this.length-1,1));return this._emitAfterChanges(2),t}push(...t){return h(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,t),this._emitAfterChanges(1)),this.length}reduce(t,e){h(this._observable);const i=this._items;return 2===arguments.length?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){h(this._observable);const i=this._items;return 2===arguments.length?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return h(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(h(this._observable),t<0||t>=this.length||this._emitBeforeChanges(2))return;const e=st(this._splice(t,1));return this._emitAfterChanges(2),e}removeMany(t){if(h(this._observable),!t||!t.length||this._emitBeforeChanges(2))return[];const e=t instanceof et?t.toArray():t,i=this._items,r=[],n=e.length;for(let t=0;t<n;t++){const n=i.indexOf(e[t]);if(n>-1){const s=1+ot(e,i,t+1,n+1),o=this._splice(n,s);o&&o.length>0&&r.push.apply(r,o),t+=s-1}}return this._emitAfterChanges(2),r}reverse(){if(h(this._observable),this._emitBeforeChanges(4))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(4),this}shift(){if(h(this._observable),!this.length||this._emitBeforeChanges(2))return;const t=st(this._splice(0,1));return this._emitAfterChanges(2),t}slice(t=0,e=this.length){return h(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return h(this._observable),this._items.some(t,e)}sort(t){if(h(this._observable),!this.length||this._emitBeforeChanges(4))return this;const e=u(this._splice(0,this.length));return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(4),this}splice(t,e,...i){h(this._observable);const r=(e?2:0)|(i.length?1:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return h(this._observable),this._items.slice()}toJSON(){return h(this._observable),this.toArray()}toLocaleString(){return h(this._observable),this._items.toLocaleString()}toString(){return h(this._observable),""+this._items}unshift(...t){return h(this._observable),!t.length||this._emitBeforeChanges(1)||(this._splice(0,0,t),this._emitAfterChanges(1)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=d((()=>this._dispatchChange()))),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const e=it.acquire();e.target=this,e.cancellable=!0;for(let i=0,n=o.length;i<n;i++)s=o[i],e.reset(s),this.emit("before-remove",e),e.defaultPrevented&&(o.splice(i,1),r.splice(t,0,s),t+=1,i-=1,n-=1);it.release(e)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const t=it.acquire();t.target=this,t.cancellable=!1;const e=o.length;for(let i=0;i<e;i++)t.reset(o[i]),this.emit("after-remove",t);it.release(t)}}if(i&&i.length){if(n){const t=[];for(const e of i){const i=n.ensureType(e);null==i&&null!=e||t.push(i)}i=t}const e=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),o=t===this.length;if(e||s){const n=it.acquire();n.target=this,n.cancellable=!0;const a=it.acquire();a.target=this,a.cancellable=!1;for(const l of i)e?(n.reset(l),this.emit("before-add",n),n.defaultPrevented||(o?r.push(l):r.splice(t++,0,l),this._set("length",r.length),s&&(a.reset(l),this.emit("after-add",a)))):(o?r.push(l):r.splice(t++,0,l),this._set("length",r.length),a.reset(l),this.emit("after-add",a));it.release(a),it.release(n)}else{if(o)for(const t of i)r.push(t);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=it.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,it.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=it.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),it.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const t=e.changes;lt.clear(),ht.clear(),ct.clear();for(const{added:e,removed:i}of t){if(e)if(0===ct.size&&0===ht.size)for(const t of e)lt.add(t);else for(const t of e)ht.has(t)?(ct.add(t),ht.delete(t)):ct.has(t)||lt.add(t);if(i)if(0===ct.size&&0===lt.size)for(const t of i)ht.add(t);else for(const t of i)lt.has(t)?lt.delete(t):(ct.delete(t),ht.add(t))}const i=f.acquire();lt.forEach((t=>{i.push(t)}));const r=f.acquire();ht.forEach((t=>{r.push(t)}));const n=this._items,s=e.items,o=f.acquire();if(ct.forEach((t=>{s.indexOf(t)!==n.indexOf(t)&&o.push(t)})),e.listeners&&(i.length||r.length||o.length)){const t={target:this,added:i,removed:r,moved:o},n=e.listeners.length;for(let i=0;i<n;i++){const r=e.listeners[i];r.removed||r.callback.call(this,t)}}f.release(i),f.release(r),f.release(o)}lt.clear(),ht.clear(),ct.clear()}};ft.ofType=i=>{if(!i)return et;if(ut.has(i))return ut.get(i);let r=null;if("function"==typeof i)r=i.prototype.declaredClass;else if(i.base)r=i.base.prototype.declaredClass;else for(const t in i.typeMap){const e=i.typeMap[t].prototype.declaredClass;r?r+=" | "+e:r=e}let n=class extends et{};return t([Q({Type:i,ensureType:"function"==typeof i?o(i):a(i)})],n.prototype,"itemType",void 0),n=t([e(`esri.core.Collection<${r}>`)],n),ut.set(i,n),n},t([l()],ft.prototype,"length",void 0),t([l()],ft.prototype,"items",null),ft=et=t([e("esri.core.Collection")],ft);const pt=ft;let gt=class extends r{constructor(t){super(t),this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach((e=>{t+=e.length})),t}add(t,e){if(!this._isHandle(t)&&!Array.isArray(t)&&!pt.isCollection(t))return this;const i=this._getOrCreateGroup(e);return Array.isArray(t)||pt.isCollection(t)?t.forEach((t=>this._isHandle(t)&&i.push(t))):i.push(t),this.notifyChange("size"),this}forEach(t,e){if("function"==typeof t)this._groups.forEach((e=>e.forEach(t)));else{const i=this._getGroup(t);i&&e&&i.forEach(e)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(Array.isArray(t)||pt.isCollection(t))return t.forEach(this.remove,this),this;if(!this.has(t))return this;const e=this._getGroup(t);for(let t=0;t<e.length;t++)e[t].remove();return this._deleteGroup(t),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((t=>{for(let e=0;e<t.length;e++)t[e].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(t){return t&&!!t.remove}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const e=[];return this._groups.set(this._ensureGroupKey(t),e),e}_getGroup(t){return u(this._groups.get(this._ensureGroupKey(t)))}_deleteGroup(t){return this._groups.delete(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}};t([l({readOnly:!0})],gt.prototype,"size",null),gt=t([e("esri.core.Handles")],gt);const mt=gt;class vt{constructor(t){this.instance=t,this._resolver=p(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=1,this._cleanUp()}),(()=>{this._status=2,this._cleanUp()}))}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(g())}when(t,e){return this._resolver.promise.then(t,e)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=p(),e=[...this._resolvingPromises,u(t.promise)],i=this._allPromise=Promise.all(e);i.then((()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)}),(t=>{this.isFulfilled()||this._allPromise!==i||m(t)||this._resolver.reject(t)})),t.resolve()}}const bt=i=>{let r=class extends i{constructor(...t){super(...t),this._promiseProps=new vt(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(t,e){return new Promise(((t,e)=>{this._promiseProps.when(t,e)})).then(t,e)}catch(t){return this.when(null,t)}addResolvingPromise(t){t&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in t?t.when():t)}};return r=t([e("esri.core.Promise")],r),r};let wt=class extends(bt(r)){};wt=t([e("esri.core.Promise")],wt);const yt=/\?(\.|$)/g;function kt(t,e,i,r){return function(t,e,i,r,n){const s="function"==typeof r?r:null,o="object"==typeof r?r:null;"boolean"==typeof r&&(n=r);let a,l=!1;function h(){a&&(a.remove(),a=null)}const c=p();v(o,(()=>{h(),c.reject(g())}));const u={then:c.promise.then.bind(c.promise),catch:c.promise.catch.bind(c.promise),remove:h};return Object.freeze(u),a=function(t,e,i,r,n){const s=t.watch(e,((t,e,n,s)=>{i&&!i(t)||null==r||r(t,e,n,s)}),n);if(Array.isArray(e))for(const n of e){const s=t.get(n);i&&i(s)&&(null==r||r(s,s,e,t))}else{const n=t.get(e);i&&i(n)&&(null==r||r(n,n,e,t))}return s}(t,e,i,((e,i,r,n)=>{l=!0,h(),s&&s.call(t,e,i,r,n),c.resolve({value:e,oldValue:i,propertyName:r,target:n})}),n),l&&h(),u}(t,e,xt,i,r)}function xt(t){return!!t}
/*!
 * @esri/arcgis-html-sanitizer - v2.9.0 - Mon Dec 13 2021 15:07:01 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var St=Object.prototype,At=Function.prototype.toString,jt=St.hasOwnProperty,It=At.call(Object),_t=St.toString,Ot=function(t,e){return function(i){return t(e(i))}}(Object.getPrototypeOf,Object),Tt={exports:{}},Et={},zt={exports:{}},Ct={};function Nt(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var Ut=/javascript\s*\:/gim;Ct.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},Ct.getDefaultWhiteList=Nt,Ct.onAttr=function(){},Ct.onIgnoreAttr=function(){},Ct.safeAttrValue=function(t,e){return Ut.test(e)?"":e};var Pt=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},Dt=function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")},Rt=Ct;function Ft(t){return null==t}function $t(t){(t=function(t){var e={};for(var i in t)e[i]=t[i];return e}(t||{})).whiteList=t.whiteList||Rt.whiteList,t.onAttr=t.onAttr||Rt.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||Rt.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||Rt.safeAttrValue,this.options=t}$t.prototype.process=function(t){if(!(t=""+(t=t||"")))return"";var e=this.options,i=e.whiteList,r=e.onAttr,n=e.onIgnoreAttr,s=e.safeAttrValue;return function(t,e){";"!==(t=Dt(t))[t.length-1]&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var i=Pt(t.slice(n,s)),a=i.indexOf(":");if(-1!==a){var l=Pt(i.slice(0,a)),h=Pt(i.slice(a+1));if(l){var c=e(n,o.length,l,h,i);c&&(o+=c+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if("/"===l&&"*"===t[s+1]){var h=t.indexOf("*/",s+2);if(-1===h)break;n=(s=h+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||a():"\n"===l&&a()}return Pt(o)}(t,(function(t,e,o,a,l){var h=i[o],c=!1;if(!0===h?c=h:"function"==typeof h?c=h(a):h instanceof RegExp&&(c=h.test(a)),!0!==c&&(c=!1),a=s(o,a)){var u,d={position:e,sourcePosition:t,source:l,isWhite:c};return c?Ft(u=r(o,a,d))?o+":"+a:u:Ft(u=n(o,a,d))?void 0:u}}))};var qt=$t;!function(t,e){var i=Ct,r=qt;for(var n in(e=t.exports=function(t,e){return new r(e).process(t)}).FilterCSS=r,i)e[n]=i[n]}(zt,zt.exports);var Mt={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/.exec(t);return e?e.index:-1}},Lt=zt.exports.getDefaultWhiteList,Bt=Mt;var Gt=new(0,zt.exports.FilterCSS);function Ht(t){return t.replace(Vt,"&lt;").replace(Jt,"&gt;")}var Vt=/</g,Jt=/>/g,Wt=/"/g,Yt=/&quot;/g,Xt=/&#([a-zA-Z0-9]*);?/gim,Zt=/&colon;?/gim,Kt=/&newline;?/gim,Qt=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,te=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ee=/u\s*r\s*l\s*\(.*/gi;function ie(t){return t.replace(Wt,"&quot;")}function re(t){return t.replace(Yt,'"')}function ne(t){return t.replace(Xt,(function(t,e){return String.fromCharCode("x"===e[0]||"X"===e[0]?parseInt(e.substr(1),16):parseInt(e,10))}))}function se(t){return t.replace(Zt,":").replace(Kt," ")}function oe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Bt.trim(e)}function ae(t){return oe(t=se(t=ne(t=re(t))))}function le(t){return Ht(t=ie(t))}Et.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},Et.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},Et.onTag=function(){},Et.onIgnoreTag=function(){},Et.onTagAttr=function(){},Et.onIgnoreTagAttr=function(){},Et.safeAttrValue=function(t,e,i,r){if(i=ae(i),"href"===e||"src"===e){if("#"===(i=Bt.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===e){if(Qt.lastIndex=0,Qt.test(i))return""}else if("style"===e){if(te.lastIndex=0,te.test(i))return"";if(ee.lastIndex=0,ee.test(i)&&(Qt.lastIndex=0,Qt.test(i)))return"";!1!==r&&(i=(r=r||Gt).process(i))}return le(i)},Et.escapeHtml=Ht,Et.escapeQuote=ie,Et.unescapeQuote=re,Et.escapeHtmlEntities=ne,Et.escapeDangerHtml5Entities=se,Et.clearNonPrintableCharacter=oe,Et.friendlyAttrValue=ae,Et.escapeAttrValue=le,Et.onIgnoreTagStripAll=function(){return""},Et.StripTagBody=function(t,e){"function"!=typeof e&&(e=function(){});var i=!Array.isArray(t),r=[],n=!1;return{onIgnoreTag:function(s,o,a){if(function(e){return!!i||-1!==Bt.indexOf(t,e)}(s)){if(a.isClosing){return r.push([!1!==n?n:a.position,a.position+10]),n=!1,"[/removed]"}return n||(n=a.position),"[removed]"}return e(s,o,a)},remove:function(t){var e="",i=0;return Bt.forEach(r,(function(r){e+=t.slice(i,r[0]),i=r[1]})),e+=t.slice(i)}}},Et.stripCommentTag=function(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("\x3c!--",i);if(-1===r){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("--\x3e",r);if(-1===n)break;i=n+3}return e},Et.stripBlankChar=function(t){var e=t.split("");return(e=e.filter((function(t){var e=t.charCodeAt(0);return!(127===e||e<=31&&10!==e&&13!==e)}))).join("")},Et.cssFilter=Gt,Et.getDefaultCSSWhiteList=Lt;var he={},ce=Mt;function ue(t){var e=ce.spaceIndex(t);if(-1===e)var i=t.slice(1,-1);else i=t.slice(1,e+1);return"/"===(i=ce.trim(i).toLowerCase()).slice(0,1)&&(i=i.slice(1)),"/"===i.slice(-1)&&(i=i.slice(0,-1)),i}function de(t){return"</"===t.slice(0,2)}var fe=/[^a-zA-Z0-9_:\.\-]/gim;function pe(t,e){for(;e<t.length;e++){var i=t[e];if(" "!==i)return"="===i?e:-1}}function ge(t,e){for(;e>0;e--){var i=t[e];if(" "!==i)return"="===i?e:-1}}function me(t){return function(t){return'"'===t[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]}(t)?t.substr(1,t.length-2):t}he.parseTag=function(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,h="",c="";t:for(a=0;a<l;a++){var u=t.charAt(a);if(!1===s){if("<"===u){s=a;continue}}else if(!1===o){if("<"===u){r+=i(t.slice(n,a)),s=a,n=a;continue}if(">"===u){r+=i(t.slice(n,s)),h=ue(c=t.slice(s,a+1)),r+=e(s,r.length,h,c,de(c)),n=a+1,s=!1;continue}if('"'===u||"'"===u)for(var d=1,f=t.charAt(a-d);""===f.trim()||"="===f;){if("="===f){o=u;continue t}f=t.charAt(a-++d)}}else if(u===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r},he.parseAttr=function(t,e){var i=0,r=[],n=!1,s=t.length;function o(t,i){if(!((t=(t=ce.trim(t)).replace(fe,"").toLowerCase()).length<1)){var n=e(t,i||"");n&&r.push(n)}}for(var a=0;a<s;a++){var l,h=t.charAt(a);if(!1!==n||"="!==h)if(!1===n||a!==i||'"'!==h&&"'"!==h||"="!==t.charAt(a-1)){if(/\s|\n|\t/.test(h)){if(t=t.replace(/\s|\n|\t/g," "),!1===n){if(-1===(l=pe(t,a))){o(ce.trim(t.slice(i,a))),n=!1,i=a+1;continue}a=l-1;continue}if(-1===(l=ge(t,a-1))){o(n,me(ce.trim(t.slice(i,a)))),n=!1,i=a+1;continue}}}else{if(-1===(l=t.indexOf(h,a+1)))break;o(n,ce.trim(t.slice(i+1,l))),n=!1,i=(a=l)+1}else n=t.slice(i,a),i=a+1}return i<t.length&&(!1===n?o(t.slice(i)):o(n,me(ce.trim(t.slice(i))))),ce.trim(r.join(" "))};var ve=zt.exports.FilterCSS,be=Et,we=he.parseTag,ye=he.parseAttr,ke=Mt;function xe(t){return null==t}function Se(t){(t=function(t){var e={};for(var i in t)e[i]=t[i];return e}(t||{})).stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=be.onIgnoreTagStripAll),t.whiteList=t.whiteList||be.whiteList,t.onTag=t.onTag||be.onTag,t.onTagAttr=t.onTagAttr||be.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||be.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||be.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||be.safeAttrValue,t.escapeHtml=t.escapeHtml||be.escapeHtml,this.options=t,!1===t.css?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new ve(t.css))}Se.prototype.process=function(t){if(!(t=""+(t=t||"")))return"";var e=this.options,i=e.whiteList,r=e.onTag,n=e.onIgnoreTag,s=e.onTagAttr,o=e.onIgnoreTagAttr,a=e.safeAttrValue,l=e.escapeHtml,h=this.cssFilter;e.stripBlankChar&&(t=be.stripBlankChar(t)),e.allowCommentTag||(t=be.stripCommentTag(t));var c=!1;e.stripIgnoreTagBody&&(c=be.StripTagBody(e.stripIgnoreTagBody,n),n=c.onIgnoreTag);var u=we(t,(function(t,e,c,u,d){var f,p={sourcePosition:t,position:e,isClosing:d,isWhite:i.hasOwnProperty(c)};if(!xe(f=r(c,u,p)))return f;if(p.isWhite){if(p.isClosing)return"</"+c+">";var g=function(t){var e=ke.spaceIndex(t);if(-1===e)return{html:"",closing:"/"===t[t.length-2]};var i="/"===(t=ke.trim(t.slice(e+1,-1)))[t.length-1];return i&&(t=ke.trim(t.slice(0,-1))),{html:t,closing:i}}(u),m=i[c],v=ye(g.html,(function(t,e){var i,r=-1!==ke.indexOf(m,t);return xe(i=s(c,t,e,r))?r?(e=a(c,t,e,h))?t+'="'+e+'"':t:xe(i=o(c,t,e,r))?void 0:i:i}));return u="<"+c,v&&(u+=" "+v),g.closing&&(u+=" /"),u+">"}return xe(f=n(c,u,p))?l(u):f}),l);return c&&(u=c.remove(u)),u};var Ae=Se;!function(t,e){var i=Et,r=he,n=Ae;function s(t,e){return new n(e).process(t)}for(var o in(e=t.exports=s).filterXSS=s,e.FilterXSS=n,i)e[o]=i[o];for(var o in r)e[o]=r[o];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=t.exports)}(Tt,Tt.exports);var je=function(){function t(t,e){var i,r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(t,e,i,n){return"a"===t&&"href"===e||("img"===t||"source"===t)&&"src"===e?r.sanitizeUrl(i):Tt.exports.safeAttrValue(t,e,i,n)}},t&&!e?i=t:t&&e?(i=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach((function(e){"whiteList"===e?i.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):i[e]=t[e]}))):(i=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=i,this._xssFilter=new Tt.exports.FilterXSS(i)}return t.prototype.sanitize=function(t,e){switch(void 0===e&&(e={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,e);default:if(e.allowUndefined&&void 0===t)return;return null}},t.prototype.sanitizeUrl=function(t){var e=this._trim(t.substring(0,t.indexOf(":")));return"/"===t||"#"===t||"#"===t[0]||this.allowedProtocols.indexOf(e.toLowerCase())>-1?Tt.exports.escapeAttrValue(t):""},t.prototype.sanitizeHTMLAttribute=function(t,e,i,r){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(t,e,i,r):Tt.exports.safeAttrValue(t,e,i,r)},t.prototype.validate=function(t,e){void 0===e&&(e={});var i=this.sanitize(t,e);return{isValid:t===i,sanitized:i}},t.prototype._extendObjectOfArrays=function(t){var e={};return t.forEach((function(t){Object.keys(t).forEach((function(i){e[i]=Array.isArray(t[i])&&Array.isArray(e[i])?e[i].concat(t[i]):t[i]}))})),e},t.prototype._iterateOverObject=function(t,e){var i=this;void 0===e&&(e={});try{var r=!1,n=void 0;if(Array.isArray(t))n=t.reduce((function(t,n){var s=i.validate(n,e);return s.isValid?t.concat([n]):(r=!0,t.concat([s.sanitized]))}),[]);else{if(!function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||"[object Object]"!=_t.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t))return!1;var e=Ot(t);if(null===e)return!0;var i=jt.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&At.call(i)==It}(t)){if(e.allowUndefined&&void 0===t)return;return null}n=Object.keys(t).reduce((function(n,s){var o=t[s],a=i.validate(o,e);return a.isValid?n[s]=o:(r=!0,n[s]=a.sanitized),n}),{})}return r?n:t}catch(t){return null}},t.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},t}();function Ie(t){const e=f.acquire();for(let t=0;t<arguments.length;t++){const i=arguments[t],r=typeof i;if("string"===r)e.push(i);else if(Array.isArray(i))e.push.apply(e,i);else if("object"===r)for(const t in i)i[t]&&e.push(t)}const i=e.join(" ");return f.release(e),i}function _e(t){this[t.getAttribute("data-node-ref")]=t}b.getLogger("esri.widgets.support.widgetUtils");const Oe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((t,e)=>(t[e]=[],t)),{}),Te=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Ee=new je({whiteList:Oe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Te.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0),ze="http://www.w3.org/",Ce=ze+"2000/svg",Ne=ze+"1999/xlink";let Ue,Pe=[],De=(t,e)=>{let i={};return Object.keys(t).forEach((e=>{i[e]=t[e]})),e&&Object.keys(e).forEach((t=>{i[t]=e[t]})),i},Re=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Fe=t=>{if("string"!=typeof t)throw Error("Style values must be strings")},$e=(t,e,i)=>{if(""!==e.vnodeSelector)for(let r=i;r<t.length;r++)if(Re(t[r],e))return r;return-1},qe=(t,e,i,r)=>{let n=t[e];if(""===n.vnodeSelector)return;let s=n.properties;if(!(s?void 0===s.key?s.bind:s.key:void 0))for(let s=0;s<t.length;s++)if(s!==e&&Re(t[s],n))throw Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)},Me=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},Le=[],Be=!1,Ge=t=>{(t.children||[]).forEach(Ge),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.call(t.properties.bind||t.properties,t.domNode)},He=()=>{Be=!1,Le.forEach(Ge),Le.length=0},Ve=t=>{Le.push(t),Be||(Be=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(He,{timeout:16}):setTimeout(He,16))},Je=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i){e.style.pointerEvents="none";let r=()=>{e.parentNode&&(e.parentNode.removeChild(e),Ve(t))};return void i(e,r,t.properties)}}e.parentNode&&(e.parentNode.removeChild(e),Ve(t))},We=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let s=n[o],a=e[s];if("className"===s)throw Error('Property "className" is not supported, use "class".');if("class"===s)Ze(t,a,!0);else if("classes"===s){let e=Object.keys(a),i=e.length;for(let r=0;r<i;r++){let i=e[r];a[i]&&t.classList.add(i)}}else if("styles"===s){let e=Object.keys(a),r=e.length;for(let n=0;n<r;n++){let r=e[n],s=a[r];s&&(Fe(s),i.styleApplyer(t,r,s))}}else if("key"!==s&&null!=a){let n=typeof a;"function"===n?(0===s.lastIndexOf("on",0)&&(r&&(a=r(s,a,t,e)),"oninput"===s&&function(){let t=a;a=function(e){t.call(this,e),e.target["oninput-value"]=e.target.value}}()),t[s]=a):i.namespace===Ce?"href"===s?t.setAttributeNS(Ne,s,a):t.setAttribute(s,a):"string"===n&&"value"!==s?"innerHTML"===s?t[s]=Ee.sanitize(a):t.setAttribute(s,a):t[s]=a}}},Ye=(t,e,i)=>{((t,e,i)=>{if(e)for(let r of e)Xe(r,t,void 0,i)})(t,e.children,i),e.text&&(t.textContent=e.text),We(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.call(e.properties.bind||e.properties,t,i,e.vnodeSelector,e.properties,e.children)},Xe=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(""===o)n=t.domNode=a.createTextNode(t.text),void 0!==i?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let h=o.charAt(l);if(l===o.length||"."===h||"#"===h){let h=o.charAt(s-1),c=o.slice(s,l);"."===h?n.classList.add(c):"#"===h?n.id=c:("svg"===c&&(r=De(r,{namespace:Ce})),void 0!==r.namespace?n=t.domNode=a.createElementNS(r.namespace,c):(n=t.domNode=t.domNode||a.createElement(c),"input"===c&&t.properties&&void 0!==t.properties.type&&n.setAttribute("type",t.properties.type)),void 0!==i?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}Ye(n,t,r)}},Ze=(t,e,i)=>{e&&e.split(" ").forEach((e=>{e&&t.classList.toggle(e,i)}))};Ue=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(""===e.vnodeSelector){if(e.text!==t.text){let t=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(t,r),e.domNode=t,n=!0,n}e.domNode=r}else 0===e.vnodeSelector.lastIndexOf("svg",0)&&(i=De(i,{namespace:Ce})),t.text!==e.text&&(s=!0,void 0===e.text?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=((t,e,i,r,n)=>{if(i===r)return!1;let s,o=(i=i||Pe).length,a=(r=r||Pe).length,l=0,h=0,c=!1;for(;h<a;){let a=l<o?i[l]:void 0,u=r[h];if(void 0!==a&&Re(a,u))c=Ue(a,u,n)||c,l++;else{let a=$e(i,u,l+1);if(a>=0){for(s=l;s<a;s++)Je(i[s]),qe(i,s,t,"removed");c=Ue(i[a],u,n)||c,l=a+1}else Xe(u,e,l<o?i[l].domNode:void 0,n),Me(u),qe(r,h,t,"added")}h++}if(o>l)for(s=l;s<o;s++)Je(i[s]),qe(i,s,t,"removed");return c})(e,r,t.children,e.children,i)||s,s=((t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let o=s[a],l=i[o],h=e[o];if("class"===o)h!==l&&(Ze(t,h,!1),Ze(t,l,!0));else if("classes"===o){let e=t.classList,i=Object.keys(l),r=i.length;for(let t=0;t<r;t++){let r=i[t],s=!!l[r];s!==!!h[r]&&(n=!0,s?e.add(r):e.remove(r))}}else if("styles"===o){let e=Object.keys(l),i=e.length;for(let s=0;s<i;s++){let i=e[s],o=l[i];o!==h[i]&&(n=!0,o?(Fe(o),r.styleApplyer(t,i,o)):r.styleApplyer(t,i,""))}}else if(l||"string"!=typeof h||(l=""),"value"===o){let e=t[o];e!==l&&(t["oninput-value"]?e===t["oninput-value"]:l!==h)&&(t[o]=l,t["oninput-value"]=void 0),l!==h&&(n=!0)}else if(l!==h){let e=typeof l;"function"===e&&r.eventHandlerInterceptor||(r.namespace===Ce?"href"===o?t.setAttributeNS(Ne,o,l):t.setAttribute(o,l):"string"===e?"innerHTML"===o?t[o]=Ee.sanitize(l):"role"===o&&""===l?t.removeAttribute(o):t.setAttribute(o,l):t[o]!==l&&(t[o]=l),n=!0)}}return n})(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.call(e.properties.bind||e.properties,r,i,e.vnodeSelector,e.properties,e.children);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let Ke=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,Ue(r,i,e)},domNode:t.domNode});const Qe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{"-"===e.charAt(0)?t.style.setProperty(e,i):t.style[e]=i}};let ti=t=>De(Qe,t),ei=(t,e,i)=>(i=ti(i),Xe(e,t,void 0,i),Ke(e,i)),ii=(t,e,i)=>(i=ti(i),Xe(e,t.parentNode,t,i),Ke(e,i)),ri=(t,e,i)=>(i=ti(i),e.domNode=t,Ye(t,e,i),Ke(e,i)),ni=(t,e,i)=>(i=ti(i),Xe(e,t.parentNode,t,i),t.parentNode.removeChild(t),Ke(e,i));const si={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties["on"+r.type].call(e.properties.bind||i,r))},oi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},ai=(t,e,i=!1)=>{let r=t;return e.forEach(((t,n)=>{var s;const o=null!=(s=r)&&s.children?((t,e)=>t.find(e))(r.children,(e=>e.domNode===t)):void 0;i&&!o&&n!==e.length-1||(r=o)})),r};let li;li="components/assets";const hi=Symbol("widget"),ci=[],ui={},di=new WeakMap;function fi(t,e){let i=e.children;if(i&&i.length)for(let e=0;e<i.length;++e)i[e]=fi(t,i[e]);else i=ci;const r=e.vnodeSelector;if(vi(r)){const n=e.properties||ui,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:pi,afterUpdate:gi,afterRemoved:mi,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function pi(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){const o=new n(s);o.container=t,di.set(t,o),null==o.afterCreate||o.afterCreate(o,t),r._internalHandles.add(k((()=>mi(t))))}function gi(t,e,i,{widgetProperties:r}){const n=di.get(t);n&&(n.set(r),null==n.afterUpdate||n.afterUpdate(n,t))}function mi(t){const e=di.get(t);e&&(e.destroy(),di.delete(t))}function vi(t){return"function"==typeof t&&t[hi]}const bi="esri.widgets.Widget",wi=b.getLogger(bi);let yi=0;const ki=new Map;function xi(t,e){for(const i in e)null!=t[i]&&("object"==typeof t[i]&&"object"==typeof e[i]?xi(t[i],e[i]):t[i]=e[i]);return t}const Si=(t=>{let e;const i={...si,...t},r=(t=>({...oi,...t}))(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],h=[],c=(t,s,o)=>{let a;r.eventHandlerInterceptor=()=>function(t){let r;n("domEvent",t);const s=((t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i})(t.currentTarget,a.domNode),o=s.some((t=>{var e;return customElements.get(null==t||null==(e=t.tagName)?void 0:e.toLowerCase())}));if(t.eventPhase!==Event.CAPTURING_PHASE&&o){const e=t.composedPath(),i=e.slice(e.indexOf(t.currentTarget),e.indexOf(a.domNode)).filter((t=>t.getRootNode()===t.ownerDocument)).reverse();r=ai(a.getLastRender(),i,!0)}else s.reverse(),r=ai(a.getLastRender(),s);let l;return r&&(l=i.handleInterceptedEvent(e,r,this,t)),n("domEventProcessed",t),l},null==i.postProcessProjectionOptions||i.postProcessProjectionOptions(r);const c=o();a=t(s,c,r),l.push(a),h.push(o),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(a,c)};let u=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let t=0;t<l.length;t++){const e=h[t]();n("rendered",void 0),l[t].update(e),n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(u=i.modifyDoRenderImplementation(u,l,h)),e={renderNow:u,scheduleRender:()=>{s||a||(s=requestAnimationFrame(u))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(t,e)=>{c(ei,t,e)},insertBefore:(t,e)=>{c(ii,t,e)},merge:(t,e)=>{c(ri,t,e)},replace:(t,e)=>{c(ni,t,e)},detach:t=>{for(let e=0;e<h.length;e++)if(h[e]===t)return h.splice(e,1),l.splice(e,1)[0];throw Error("renderFunction was not found")}},e})({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(t,r,n,s)=>{const o=e(t,r,n,s),a=i.test(t);if(!((t=t.replace(i,"")).toLowerCase()in n)||a){const e=t[2].toLowerCase()+t.slice(3),i=t=>o.call(n,t);n.addEventListener(e,i,a);const r=()=>n.removeEventListener(e,i,a),l=s.afterRemoved;s.afterRemoved=t=>{null==l||l(t),r()}}return o}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,a in l))&&(ki.clear(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let Ai=!1,ji=class extends(bt(K.EventedAccessor)){constructor(t,e){super(t,e),this._attached=!1,this._internalHandles=new mt,this._projector=Si,this._readyForTrueRender=!1,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=x((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const t=await E(this._messageBundleProps.map((async({bundlePath:t,propertyName:e})=>{let i=await z(t);this.uiStrings&&Object.keys(this.uiStrings)&&(i=xi(c(i),this.uiStrings)),this[e]=i})));for(const e of t)e.error&&wi.error("widget-intl:locale-error",this.declaredClass,e.error)}await this.loadLocale()})),w(y("components/assets"));const i=getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")||"light";["light","dark"].includes(i)||S(wi,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const r="esri-widget-uid-"+function(){const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=e=>t[e].toString(16);return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}(),n=this.render.bind(this);this._trackingTarget=new A((()=>this.scheduleRender()));const s=()=>{var t;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const e=n();let{properties:i}=e;i||(e.properties=i={});let{key:s,styles:o}=i;s||(i.key=r),o||(i.styles=o={}),o.display||(o.display="");let a=0;return null==(t=e.children)||t.forEach((t=>{if(vi(t.vnodeSelector))return;let{properties:e}=t;e||(t.properties=e={}),e.key||(e.key=`${this.id}--${a++}`)})),fi(this,e)};this.render=()=>{if(Ai)return s();let t=ki.get(this);if(t)return t;this._trackingTarget.clear(),Ai=!0;try{t=j(this._trackingTarget,s)}finally{Ai=!1}return ki.set(this,t),t},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{this._readyForTrueRender=!0,this._postInitialize()})))}normalizeCtorArgs(t,e){const i={...t};return e&&(i.container=e),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then((()=>{})).catch(I)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget=_(this._trackingTarget),this.viewModel=_(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,ki.delete(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return function(t){return"string"==typeof t?document.getElementById(t):t}(t)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+yi++}set id(t){t&&this._set("id",t)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw Error("not implemented")}scheduleRender(){this.destroyed||(ki.delete(this),this._projector.scheduleRender())}classes(...t){return Ie.apply(this,t)}own(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments)),this._internalHandles.add(t)}renderNow(){ki.delete(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(function(t,e,i){const r=[e],n=function(t,e,i){return t.watch("viewModel",i,undefined)}(t,0,i);for(const e of r){const r=e.trim().replace(yt,"$1"),n=t.get(r);i.call(t,n,n,r,t)}return n}(this,"viewModel",((t,e)=>{e&&this._internalHandles.remove("delegated-events"),t&&this._internalHandles.add(this._delegatedEventNames.map((e=>t.on(e,(t=>{this.emit(e,t)})))),"delegated-events")}))),this.postInitialize();const e=async()=>{await this._loadLocale().catch(I),this.scheduleRender()};this._internalHandles.add([O(e),this.watch("uiStrings",e),kt(this,"container",(async t=>{this.destroyed||this._attach(t)}))])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){t&&this._attached&&(this._projector.detach(this.render),t.parentNode&&t.parentNode.removeChild(t),this._attached=!1)}};ji[hi]=!0,t([l()],ji.prototype,"_readyForTrueRender",void 0),t([l({value:null})],ji.prototype,"container",null),t([T("container")],ji.prototype,"castContainer",null),t([l({aliasOf:"container"})],ji.prototype,"domNode",void 0),t([l()],ji.prototype,"iconClass",void 0),t([l()],ji.prototype,"id",null),t([l()],ji.prototype,"label",void 0),t([l()],ji.prototype,"renderable",null),t([l()],ji.prototype,"uiStrings",void 0),t([l()],ji.prototype,"viewModel",void 0),t([l()],ji.prototype,"visible",void 0),t([l()],ji.prototype,"key",void 0),t([l()],ji.prototype,"children",void 0),t([l()],ji.prototype,"afterCreate",void 0),t([l()],ji.prototype,"afterUpdate",void 0),t([l()],ji.prototype,"afterRemoved",void 0),ji=t([e(bi)],ji);const Ii=ji;function _i(t){return function(e,i){e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Oi=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:""+t,domNode:null}},Ti=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?Ti(n,e):null!=n&&!1!==n&&(n.hasOwnProperty("vnodeSelector")||(n=Oi(n)),e.push(n))}},Ei=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return Ti(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function zi(t,e,...i){return"function"!=typeof t||vi(t)?Ei(t,e,...i):t(e,...i)}const Ci="esri-identity-form__group",Ni="esri-identity-form__label";let Ui=class extends Ii{constructor(t,e){super(t,e),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:t,server:e,resource:i,signingIn:r,oAuthPrompt:n,messages:s}=this,o=zi("div",{class:Ci},C(n?s.oAuthInfo:s.info,{server:/\.arcgis\.com/i.test(e)?"ArcGIS Online":e,resource:`(${i||s.lblItem})`})),a=n?null:zi("div",{class:Ci,key:"username"},zi("label",{class:Ni},s.lblUser,zi("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:_e,"data-node-ref":"_usernameInputNode",class:"esri-input"}))),l=n?null:zi("div",{class:Ci,key:"password"},zi("label",{class:Ni},s.lblPwd,zi("input",{value:"",required:!0,type:"password",bind:this,afterCreate:_e,"data-node-ref":"_passwordInputNode",class:"esri-input"}))),h=zi("div",{class:this.classes(Ci,"esri-identity-form__footer")},zi("input",{type:"submit",disabled:!!r,value:r?s.lblSigning:s.lblOk,class:"esri-button"}),zi("input",{type:"button",value:s.lblCancel,bind:this,onclick:this._cancel,class:this.classes("esri-button","esri-button--secondary")})),c=t?zi("div",null,t.details&&t.details.httpStatus?s.invalidUser:s.noAuthService):null;return zi("form",{class:"esri-identity-form",bind:this,onsubmit:this._submit},o,c,a,l,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(t){t.preventDefault(),this._set("signingIn",!0),this.emit("submit",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})}};t([l(),_i("esri/identity/t9n/identity")],Ui.prototype,"messages",void 0),t([l()],Ui.prototype,"signingIn",void 0),t([l()],Ui.prototype,"server",void 0),t([l()],Ui.prototype,"resource",void 0),t([l()],Ui.prototype,"error",void 0),t([l()],Ui.prototype,"oAuthPrompt",void 0),Ui=t([e("esri.identity.IdentityForm")],Ui);const Pi=Ui;
/*!
* tabbable 5.2.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/
var Di=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Ri=Di.join(","),Fi="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,$i=function(t,e,i){var r=Array.prototype.slice.apply(t.querySelectorAll(Ri));return e&&Fi.call(t,Ri)&&r.unshift(t),r.filter(i)},qi=function(t){var e=parseInt(t.getAttribute("tabindex"),10);return isNaN(e)?function(t){return"true"===t.contentEditable}(t)?0:"AUDIO"!==t.nodeName&&"VIDEO"!==t.nodeName&&"DETAILS"!==t.nodeName||null!==t.getAttribute("tabindex")?t.tabIndex:0:e},Mi=function(t,e){return t.tabIndex===e.tabIndex?t.documentOrder-e.documentOrder:t.tabIndex-e.tabIndex},Li=function(t){return"INPUT"===t.tagName},Bi=function(t,e){return!(e.disabled||function(t){return Li(t)&&"hidden"===t.type}(e)||function(t,e){if("hidden"===getComputedStyle(t).visibility)return!0;var i=Fi.call(t,"details>summary:first-of-type");if(Fi.call(i?t.parentElement:t,"details:not([open]) *"))return!0;if(e&&"full"!==e){if("non-zero-area"===e){var r=t.getBoundingClientRect();return 0===r.width&&0===r.height}}else for(;t;){if("none"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}(e,t.displayCheck)||function(t){return"DETAILS"===t.tagName&&Array.prototype.slice.apply(t.children).some((function(t){return"SUMMARY"===t.tagName}))}(e)||function(t){if(Li(t)||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||"BUTTON"===t.tagName)for(var e=t.parentElement;e;){if("FIELDSET"===e.tagName&&e.disabled){for(var i=0;i<e.children.length;i++){var r=e.children.item(i);if("LEGEND"===r.tagName)return!r.contains(t)}return!0}e=e.parentElement}return!1}(e))},Gi=function(t,e){return!(!Bi(t,e)||function(t){return function(t){return Li(t)&&"radio"===t.type}(t)&&!function(t){if(!t.name)return!0;var e,i=t.form||t.ownerDocument,r=function(t){return i.querySelectorAll('input[type="radio"][name="'+t+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)e=r(window.CSS.escape(t.name));else try{e=r(t.name)}catch(t){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",t.message),!1}var n=function(t,e){for(var i=0;i<t.length;i++)if(t[i].checked&&t[i].form===e)return t[i]}(e,t.form);return!n||n===t}(t)}(e)||qi(e)<0)},Hi=function(t,e){if(e=e||{},!t)throw Error("No node provided");return!1!==Fi.call(t,Ri)&&Gi(e,t)},Vi=Di.concat("iframe").join(","),Ji=function(t,e){if(e=e||{},!t)throw Error("No node provided");return!1!==Fi.call(t,Vi)&&Bi(e,t)};
/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/
function Wi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Yi(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Xi=function(){var t=[];return{activateTrap:function(e){if(t.length>0){var i=t[t.length-1];i!==e&&i.pause()}var r=t.indexOf(e);-1===r||t.splice(r,1),t.push(e)},deactivateTrap:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1),t.length>0&&t[t.length-1].unpause()}}}(),Zi=function(t){return setTimeout(t,0)},Ki=function(t,e){var i=-1;return t.every((function(t,r){return!e(t)||(i=r,!1)})),i},Qi=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return"function"==typeof t?t.apply(void 0,i):t},tr=function(t){return t.target.shadowRoot&&"function"==typeof t.composedPath?t.composedPath()[0]:t.target};const er="esri-identity-modal__content";let ir=class extends Ii{constructor(t,e){super(t,e),this.container=document.createElement("div"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch("open",(()=>this._toggleFocusTrap())))}destroy(){this._destroyFocusTrap()}render(){const t=this.id,{open:e,content:i,title:r,messages:n}=this,s=e&&!!i,o={"esri-identity-modal--open":s,"esri-identity-modal--closed":!s},a=zi("button",{class:"esri-identity-modal__close-button","aria-label":n.close,title:n.close,bind:this,onclick:this._close},zi("span",{"aria-hidden":"true",class:"esri-icon-close"})),l=t+"_title",h=t+"_content",c=r?zi("h1",{id:l,class:"esri-identity-modal__title"},r):null,u=s?zi("div",{bind:this,class:"esri-identity-modal__dialog",role:"dialog","aria-labelledby":l,"aria-describedby":h,afterCreate:this._createFocusTrap},a,c,this._renderContent(h)):null;return zi("div",{tabIndex:-1,class:this.classes("esri-identity-modal",o)},u)}_destroyFocusTrap(){var t;null==(t=this._focusTrap)||t.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap();const e=requestAnimationFrame((()=>{this._focusTrap=function(t,e){var i,r=(null==e?void 0:e.document)||document,n=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Wi(Object(i),!0).forEach((function(e){Yi(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Wi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},e),s={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},o=function(t,e,i){return t&&void 0!==t[e]?t[e]:n[i||e]},a=function(t){return!(!t||!s.containers.some((function(e){return e.contains(t)})))},l=function(t){var e=n[t];if("function"==typeof e){for(var i=arguments.length,s=Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];e=e.apply(void 0,s)}if(!e){if(void 0===e||!1===e)return e;throw Error("`".concat(t,"` was specified but was not a node, or did not return a node"))}var a=e;if("string"==typeof e&&!(a=r.querySelector(e)))throw Error("`".concat(t,"` as selector refers to no known node"));return a},h=function(){var t=l("initialFocus");if(!1===t)return!1;if(void 0===t)if(a(r.activeElement))t=r.activeElement;else{var e=s.tabbableGroups[0];t=e&&e.firstTabbableNode||l("fallbackFocus")}if(!t)throw Error("Your focus-trap needs to have at least one focusable element");return t},c=function(){if(s.tabbableGroups=s.containers.map((function(t){var e=function(t,e){var i=[],r=[];return $i(t,(e=e||{}).includeContainer,Gi.bind(null,e)).forEach((function(t,e){var n=qi(t);0===n?i.push(t):r.push({documentOrder:e,tabIndex:n,node:t})})),r.sort(Mi).map((function(t){return t.node})).concat(i)}(t),i=function(t,e){return $i(t,(e=e||{}).includeContainer,Bi.bind(null,e))}(t);if(e.length>0)return{container:t,firstTabbableNode:e[0],lastTabbableNode:e[e.length-1],nextTabbableNode:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=i.findIndex((function(e){return e===t}));return e?i.slice(r+1).find((function(t){return Hi(t)})):i.slice(0,r).reverse().find((function(t){return Hi(t)}))}}})).filter((function(t){return!!t})),s.tabbableGroups.length<=0&&!l("fallbackFocus"))throw Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},u=function t(e){!1!==e&&e!==r.activeElement&&(e&&e.focus?(e.focus({preventScroll:!!n.preventScroll}),s.mostRecentlyFocusedNode=e,function(t){return t.tagName&&"input"===t.tagName.toLowerCase()&&"function"==typeof t.select}(e)&&e.select()):t(h()))},d=function(t){var e=l("setReturnFocus",t);return e||!1!==e&&t},f=function(t){var e=tr(t);a(e)||(Qi(n.clickOutsideDeactivates,t)?i.deactivate({returnFocus:n.returnFocusOnDeactivate&&!Ji(e)}):Qi(n.allowOutsideClick,t)||t.preventDefault())},p=function(t){var e=tr(t),i=a(e);i||e instanceof Document?i&&(s.mostRecentlyFocusedNode=e):(t.stopImmediatePropagation(),u(s.mostRecentlyFocusedNode||h()))},g=function(t){if(function(t){return"Escape"===t.key||"Esc"===t.key||27===t.keyCode}(t)&&!1!==Qi(n.escapeDeactivates,t))return t.preventDefault(),void i.deactivate();(function(t){return"Tab"===t.key||9===t.keyCode})(t)&&function(t){var e=tr(t);c();var i=null;if(s.tabbableGroups.length>0){var r=Ki(s.tabbableGroups,(function(t){return t.container.contains(e)})),n=r>=0?s.tabbableGroups[r]:void 0;if(r<0)i=t.shiftKey?s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:s.tabbableGroups[0].firstTabbableNode;else if(t.shiftKey){var o=Ki(s.tabbableGroups,(function(t){return e===t.firstTabbableNode}));o<0&&(n.container===e||Ji(e)&&!Hi(e)&&!n.nextTabbableNode(e,!1))&&(o=r),o>=0&&(i=s.tabbableGroups[0===o?s.tabbableGroups.length-1:o-1].lastTabbableNode)}else{var a=Ki(s.tabbableGroups,(function(t){return e===t.lastTabbableNode}));a<0&&(n.container===e||Ji(e)&&!Hi(e)&&!n.nextTabbableNode(e))&&(a=r),a>=0&&(i=s.tabbableGroups[a===s.tabbableGroups.length-1?0:a+1].firstTabbableNode)}}else i=l("fallbackFocus");i&&(t.preventDefault(),u(i))}(t)},m=function(t){if(!Qi(n.clickOutsideDeactivates,t)){var e=tr(t);a(e)||Qi(n.allowOutsideClick,t)||(t.preventDefault(),t.stopImmediatePropagation())}},v=function(){if(s.active)return Xi.activateTrap(i),s.delayInitialFocusTimer=n.delayInitialFocus?Zi((function(){u(h())})):u(h()),r.addEventListener("focusin",p,!0),r.addEventListener("mousedown",f,{capture:!0,passive:!1}),r.addEventListener("touchstart",f,{capture:!0,passive:!1}),r.addEventListener("click",m,{capture:!0,passive:!1}),r.addEventListener("keydown",g,{capture:!0,passive:!1}),i},b=function(){if(s.active)return r.removeEventListener("focusin",p,!0),r.removeEventListener("mousedown",f,!0),r.removeEventListener("touchstart",f,!0),r.removeEventListener("click",m,!0),r.removeEventListener("keydown",g,!0),i};return(i={activate:function(t){if(s.active)return this;var e=o(t,"onActivate"),i=o(t,"onPostActivate"),n=o(t,"checkCanFocusTrap");n||c(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=r.activeElement,e&&e();var a=function(){n&&c(),v(),i&&i()};return n?(n(s.containers.concat()).then(a,a),this):(a(),this)},deactivate:function(t){if(!s.active)return this;clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,b(),s.active=!1,s.paused=!1,Xi.deactivateTrap(i);var e=o(t,"onDeactivate"),r=o(t,"onPostDeactivate"),n=o(t,"checkCanReturnFocus");e&&e();var a=o(t,"returnFocus","returnFocusOnDeactivate"),l=function(){Zi((function(){a&&u(d(s.nodeFocusedBeforeActivation)),r&&r()}))};return a&&n?(n(d(s.nodeFocusedBeforeActivation)).then(l,l),this):(l(),this)},pause:function(){return s.paused||!s.active||(s.paused=!0,b()),this},unpause:function(){return s.paused&&s.active?(s.paused=!1,c(),v(),this):this},updateContainerElements:function(t){var e=[].concat(t).filter(Boolean);return s.containers=e.map((function(t){return"string"==typeof t?r.querySelector(t):t})),s.active&&c(),this}}).updateContainerElements(t),i}(t,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()}));this.own(k((()=>cancelAnimationFrame(e))))}_renderContent(t){const e=this.content;return"string"==typeof e?zi("div",{class:er,id:t,innerHTML:e}):function(t){return t&&"function"==typeof t.render}(e)?zi("div",{class:er,id:t},e.render()):e instanceof HTMLElement?zi("div",{class:er,id:t,bind:e,afterCreate:this._attachToNode}):null}_attachToNode(t){t.appendChild(this)}};t([l({readOnly:!0})],ir.prototype,"container",void 0),t([l()],ir.prototype,"content",void 0),t([l()],ir.prototype,"open",void 0),t([l(),_i("esri/t9n/common")],ir.prototype,"messages",void 0),t([l({aliasOf:"messages.auth.signIn"})],ir.prototype,"title",void 0),ir=t([e("esri.identity.IdentityModal")],ir);const rr=ir,nr="esriJSAPIOAuth";class sr{constructor(t,e){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=e,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.token&&this.userId){const e=Date.now();this.expires>e&&(this.expires-e)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}return t}save(){if(!this.storage)return;const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let i=t[e.authNamespace];i||(i=t[e.authNamespace]={}),i[e.portalUrl]={appId:this.appId=e.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem(nr,JSON.stringify(t))}catch(t){console.log(t)}}}destroy(){const t=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&this.token&&this.expires>Date.now()){const t=e.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.token),i.append("client_id",e.appId),i.append("token_type_hint","access_token"),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(t,i);else{const e=new XMLHttpRequest;e.open("POST",t),e.send(i)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage){const i=t[e.authNamespace];if(i){delete i[e.portalUrl];try{this.storage.setItem(nr,JSON.stringify(t))}catch(t){console.log(t)}}}e&&(e._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let i=t[e.authNamespace];i&&(i=i[e.portalUrl],i&&(this.appId=i.appId,this.expires=i.expires,this.ssl=i.ssl,this.token=i.token,this.userId=i.userId))}}_load(){let t={};if(this.storage){const e=this.storage.getItem(nr);if(e)try{t=JSON.parse(e)}catch(t){console.log(t)}}return t}}var or;sr.prototype.declaredClass="esri.identity.OAuthCredential";let ar=or=class extends N{constructor(t){super(t),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return or.fromJSON(this.toJSON())}};t([l({json:{write:!0}})],ar.prototype,"appId",void 0),t([l({json:{write:!0}})],ar.prototype,"authNamespace",void 0),t([l({json:{write:!0}})],ar.prototype,"expiration",void 0),t([l({json:{write:!0}})],ar.prototype,"forceLogin",void 0),t([l({json:{write:!0}})],ar.prototype,"forceUserId",void 0),t([l({json:{write:!0}})],ar.prototype,"locale",void 0),t([l({json:{write:!0}})],ar.prototype,"minTimeUntilExpiration",void 0),t([l({json:{write:!0}})],ar.prototype,"popup",void 0),t([l({json:{write:!0}})],ar.prototype,"popupCallbackUrl",void 0),t([l({json:{write:!0}})],ar.prototype,"popupWindowFeatures",void 0),t([l({json:{write:!0}})],ar.prototype,"portalUrl",void 0),t([l({json:{write:!0}})],ar.prototype,"preserveUrlHash",void 0),t([l({json:{write:!0}})],ar.prototype,"userId",void 0),ar=or=t([e("esri.identity.OAuthInfo")],ar);const lr=ar;let hr=class extends N{constructor(t){super(t),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};t([l({json:{write:!0}})],hr.prototype,"adminTokenServiceUrl",void 0),t([l({json:{write:!0}})],hr.prototype,"currentVersion",void 0),t([l({json:{write:!0}})],hr.prototype,"hasPortal",void 0),t([l({json:{write:!0}})],hr.prototype,"hasServer",void 0),t([l({json:{write:!0}})],hr.prototype,"owningSystemUrl",void 0),t([l({json:{write:!0}})],hr.prototype,"owningTenant",void 0),t([l({json:{write:!0}})],hr.prototype,"server",void 0),t([l({json:{write:!0}})],hr.prototype,"shortLivedTokenValidity",void 0),t([l({json:{write:!0}})],hr.prototype,"tokenServiceUrl",void 0),t([l({json:{write:!0}})],hr.prototype,"webTierAuth",void 0),hr=t([e("esri.identity.ServerInfo")],hr);const cr=hr,ur={},dr=t=>{const e=new D(t.owningSystemUrl).host,i=new D(t.server).host,r=/.+\.arcgis\.com$/i;return r.test(e)&&r.test(i)},fr=(t,e)=>!!(dr(t)&&e&&e.some((e=>e.test(t.server))));let pr=null,gr=null;try{pr=window.localStorage,gr=window.sessionStorage}catch{}class mr extends K{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=Pi,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin="null"!==window.origin?window.origin:window.location.origin,this._appUrlObj=R(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener("pageshow",(t=>{this._pageShowHandler(t)}))}registerServers(t){const e=this.serverInfos;e?(t=t.filter((t=>!this.findServerInfo(t.server))),this.serverInfos=e.concat(t)):this.serverInfos=t,t.forEach((t=>{t.owningSystemUrl&&this._portals.push(t.owningSystemUrl),t.hasPortal&&this._portals.push(t.server)}))}registerOAuthInfos(t){const e=this.oAuthInfos;if(e){for(const i of t){const t=this.findOAuthInfo(i.portalUrl);t&&e.splice(e.indexOf(t),1)}this.oAuthInfos=e.concat(t)}else this.oAuthInfos=t}registerToken(t){t={...t};const e=this._sanitizeUrl(t.server),i=this._isServerRsrc(e);let r,n=this.findServerInfo(e),s=!0;n||(n=new cr,n.server=this._getServerInstanceRoot(e),i?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(e),n.hasPortal=!0),this.registerServers([n])),r=this._findCredential(e),r?(delete t.server,Object.assign(r,t),s=!1):(r=new vr({userId:t.userId,server:n.server,token:t.token,expires:t.expires,ssl:t.ssl,scope:i?"server":"portal"}),r.resources=[e],this.credentials.push(r)),r.emitTokenChange(!1),s||r.refreshServerTokens()}toJSON(){return P({serverInfos:this.serverInfos.map((t=>t.toJSON())),oAuthInfos:this.oAuthInfos.map((t=>t.toJSON())),credentials:this.credentials.map((t=>t.toJSON()))})}initialize(t){if(!t)return;"string"==typeof t&&(t=JSON.parse(t));const e=t.serverInfos,i=t.oAuthInfos,r=t.credentials;if(e){const t=[];e.forEach((e=>{e.server&&e.tokenServiceUrl&&t.push(e.declaredClass?e:new cr(e))})),t.length&&this.registerServers(t)}if(i){const t=[];i.forEach((e=>{e.appId&&t.push(e.declaredClass?e:new lr(e))})),t.length&&this.registerOAuthInfos(t)}r&&r.forEach((t=>{t.server&&t.token&&t.expires&&t.expires>Date.now()&&((t=t.declaredClass?t:new vr(t)).emitTokenChange(),this.credentials.push(t))}))}findServerInfo(t){let e;t=this._sanitizeUrl(t);for(const i of this.serverInfos)if(this._hasSameServerInstance(i.server,t)){e=i;break}return e}findOAuthInfo(t){let e;t=this._sanitizeUrl(t);for(const i of this.oAuthInfos)if(this._hasSameServerInstance(i.portalUrl,t)){e=i;break}return e}findCredential(t,e){let i;t=this._sanitizeUrl(t);const r=this._isServerRsrc(t)?"server":"portal";if(e){for(const n of this.credentials)if(this._hasSameServerInstance(n.server,t)&&e===n.userId&&n.scope===r){i=n;break}}else for(const e of this.credentials)if(this._hasSameServerInstance(e.server,t)&&-1!==this._getIdenticalSvcIdx(t,e)&&e.scope===r){i=e;break}return i}getCredential(t,e){let i,r,n=!0;e&&(i=!!e.token,r=e.error,n=!1!==e.prompt),e={...e},t=this._sanitizeUrl(t);const s=new AbortController,o=F();if(e.signal&&v(e.signal,(()=>{s.abort()})),v(s,(()=>{o.reject(new $("identity-manager:user-aborted","ABORTED"))})),q(s))return o.promise;e.signal=s.signal;const a=this._isAdminResource(t),l=i?this.findCredential(t):null;let h;if(l&&r&&r.details&&498===r.details.httpStatus)l.destroy();else if(l)return h=new $("identity-manager:not-authorized","You are currently signed in as: '"+l.userId+"'. You do not have access to this resource: "+t,{error:r}),o.reject(h),o.promise;const c=this._findCredential(t,e);if(c)return o.resolve(c),o.promise;let u=this.findServerInfo(t);if(u)!u.hasServer&&this._isServerRsrc(t)&&(u._restInfoPms=this._getTokenSvcUrl(t),u.hasServer=!0);else{const e=this._getTokenSvcUrl(t);if(!e)return h=new $("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),o.reject(h),o.promise;u=new cr,u.server=this._getServerInstanceRoot(t),"string"==typeof e?(u.tokenServiceUrl=e,u.hasPortal=!0):(u._restInfoPms=e,u.hasServer=!0),this.registerServers([u])}return u.hasPortal&&void 0===u._selfReq&&(n||M(u.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((t=>t.tokenServiceUrl===u.tokenServiceUrl)))&&(u._selfReq={owningTenant:e&&e.owningTenant,selfDfd:this._getPortalSelf(u.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),t)}),this._enqueue(t,u,e,o,a)}getResourceName(t){return this._isRESTService(t)?t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(t)&&t.replace(this._gwUser,"$1")||this._gwItem.test(t)&&t.replace(this._gwItem,"$1")||this._gwGroup.test(t)&&t.replace(this._gwGroup,"$1")||""}generateToken(t,e,i){const r=this._rePortalTokenSvc.test(t.tokenServiceUrl),n=new D(this._appOrigin),s=t.shortLivedTokenValidity;let o,a,l,h,c,u,d,f;e&&(f=this.tokenValidity||s||this.defaultTokenValidity,f>s&&s>0&&(f=s)),i&&(o=i.isAdmin,a=i.serverUrl,l=i.token,u=i.signal,d=i.ssl,t.customParameters=i.customParameters),o?h=t.adminTokenServiceUrl:(h=t.tokenServiceUrl,c=new D(h.toLowerCase()),t.webTierAuth&&null!=i&&i.serverUrl&&!d&&"http"===n.scheme&&(M(n.uri,h,!0)||"https"===c.scheme&&n.host===c.host&&"7080"===n.port&&"7443"===c.port)&&(h=h.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const p={query:{request:"getToken",username:null==e?void 0:e.username,password:null==e?void 0:e.password,serverUrl:a,token:l,expiration:f,referer:o||r?this._appOrigin:null,client:o?"referer":null,f:"json",...t.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(t,i),signal:u,...null==i?void 0:i.ioArgs};return r||(p.withCredentials=!1),L(h,p).then((i=>{const r=i.data;if(!r||!r.token)return new $("identity-manager:authentication-failed","Unable to generate token");const n=t.server;return ur[n]||(ur[n]={}),e&&(ur[n][e.username]=e.password),r.validity=f,r}))}isBusy(){return!!this._busy}checkSignInStatus(t){return this.checkAppAccess(t,"").then((t=>t.credential))}checkAppAccess(t,e,i){let r=!1;return this.getCredential(t,{prompt:!1}).then((n=>{let s;const o={f:"json"};if("portal"===n.scope)if(e&&(this._doPortalSignIn(t)||i&&i.force))s=n.server+"/sharing/rest/oauth2/validateAppAccess",o.client_id=e;else{if(!n.token)return{credential:n};s=n.server+"/sharing/rest"}else{if(!n.token)return{credential:n};s=n.server+"/rest/services"}return n.token&&(o.token=n.token),L(s,{query:o,authMode:"anonymous"}).then((t=>{if(!1===t.data.valid)throw new $("identity-manager:not-authorized",`You are currently signed in as: '${n.userId}'.`,t.data);return r=!!t.data.viewOnlyUserTypeApp,{credential:n}})).catch((t=>{if("identity-manager:not-authorized"===t.name)throw t;const e=t.details&&t.details.httpStatus;if(498===e)throw n.destroy(),new $("identity-manager:not-authenticated","User is not signed in.");if(400===e)throw new $("identity-manager:invalid-request");return{credential:n}}))})).then((t=>({credential:t.credential,viewOnly:r})))}setOAuthResponseHash(t){var e;const i=this._oAuthDfd;if(this._oAuthDfd=null,!i||!t)return;clearInterval(this._oAuthIntervalId),null==(e=this._oAuthOnHashHandle)||e.remove(),"#"===t.charAt(0)&&(t=t.substring(1));const r=B(t);if(r.error){const t="access_denied"===r.error,e=new $(t?"identity-manager:user-aborted":"identity-manager:authentication-failed",t?"ABORTED":"OAuth: "+r.error+" - "+r.error_description);i.reject(e)}else{const t=i.oinfo_,e=t._oAuthCred,n=new vr({userId:r.username,server:i.sinfo_.server,token:r.access_token,expires:Date.now()+1e3*Number(r.expires_in),ssl:"true"===r.ssl,_oAuthCred:e});t.userId=n.userId,e.storage=r.persist?pr:gr,e.token=n.token,e.expires=n.expires,e.userId=n.userId,e.ssl=n.ssl,e.save(),i.resolve(n)}}setOAuthRedirectionHandler(t){this._oAuthRedirectFunc=t}setProtocolErrorHandler(t){this._protocolFunc=t}signIn(t,e,i={}){const r=F(),n=()=>{var t,e,i,r,n;null==(t=a)||t.remove(),null==(e=l)||e.remove(),null==(i=h)||i.remove(),null==(r=o)||r.destroy(),null==(n=this.dialog)||n.destroy(),this.dialog=o=a=l=h=null},s=()=>{n(),this._oAuthDfd=null,r.reject(new $("identity-manager:user-aborted","ABORTED"))};i.signal&&v(i.signal,(()=>{s()}));let o=new this.formConstructor;o.resource=this.getResourceName(t),o.server=e.server,this.dialog=new rr,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");let a=o.on("cancel",s),l=this.dialog.watch("open",s),h=o.on("submit",(t=>{this.generateToken(e,t,{isAdmin:i.isAdmin,signal:i.signal}).then((s=>{n();const o=new vr({userId:t.username,server:e.server,token:s.token,expires:null!=s.expires?Number(s.expires):null,ssl:!!s.ssl,isAdmin:i.isAdmin,validity:s.validity});r.resolve(o)})).catch((t=>{o.error=t,o.signingIn=!1}))}));return r.promise}oAuthSignIn(t,e,i,r){this._oAuthDfd=F();const n=this._oAuthDfd;if(null!=r&&r.signal&&v(r.signal,(()=>{const t=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;t&&!t.closed?t.close():this.dialog&&o()})),n.resUrl_=t,n.sinfo_=e,n.oinfo_=i,!i.popup||r&&!1===r.oAuthPopupConfirmation)return this._doOAuthSignIn(t,e,i),n.promise;const s=new this.formConstructor;s.oAuthPrompt=!0,s.server=e.server,this.dialog=new rr,this.dialog.content=s,this.dialog.open=!0,this.emit("dialog-create");const o=()=>{c(),this._oAuthDfd=null,n.reject(new $("identity-manager:user-aborted","ABORTED"))},a=s.on("cancel",o),l=this.dialog.watch("open",o),h=s.on("submit",(()=>{c(),this._doOAuthSignIn(t,e,i)})),c=()=>{a.remove(),l.remove(),h.remove(),s.destroy(),this.dialog.destroy(),this.dialog=null};return n.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach((t=>{t.destroy()})),this.emit("credentials-destroy")}enablePostMessageAuth(t="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=G(window,"message",(e=>{var i;if((e.origin===this._appOrigin||e.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(i=e.data)?void 0:i.type)){const i=e.source;this.getCredential(t).then((t=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:t.expires,server:t.server,ssl:t.ssl,token:t.token,userId:t.userId}},e.origin)})).catch((t=>{i.postMessage({type:"arcgis:auth:error",error:{name:t.name,message:t.message}},e.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthHash(){let t=window.location.hash;if(t){"#"===t.charAt(0)&&(t=t.substring(1));const e=B(t);let i=!1;if(e.access_token&&e.expires_in&&e.state&&e.hasOwnProperty("username"))try{e.state=JSON.parse(e.state),"object"==typeof e.state&&e.state.portalUrl&&(this._oAuthHash=e,i=!0)}catch{}else e.error&&e.error_description&&(console.log("IdentityManager OAuth Error: ",e.error," - ",e.error_description),"access_denied"===e.error&&(i=!0));i&&(window.location.hash="object"==typeof e.state&&e.state.hash||"")}}_pageShowHandler(t){if(t.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const t=new $("identity-manager:user-aborted","ABORTED");this._errbackFunc(t)}}_findCredential(t,e){let i,r,n,s,o=-1;const a=e&&e.token,l=e&&e.resource,h=this._isServerRsrc(t)?"server":"portal",c=this.credentials.filter((e=>this._hasSameServerInstance(e.server,t)&&e.scope===h));if(t=l||t,c.length)if(1===c.length){if(i=c[0],s=this.findServerInfo(i.server),r=s&&s.owningSystemUrl,n=r&&this.findCredential(r,i.userId),o=this._getIdenticalSvcIdx(t,i),!a)return-1===o&&i.resources.push(t),this._addResource(t,n),i;-1!==o&&(i.resources.splice(o,1),this._removeResource(t,n))}else{let e,i;if(c.some((a=>(i=this._getIdenticalSvcIdx(t,a),-1!==i&&(e=a,s=this.findServerInfo(e.server),r=s&&s.owningSystemUrl,n=r&&this.findCredential(r,e.userId),o=i,!0)))),a)e&&(e.resources.splice(o,1),this._removeResource(t,n));else if(e)return this._addResource(t,n),e}}_findOAuthInfo(t){let e=this.findOAuthInfo(t);if(!e)for(const i of this.oAuthInfos)if(this._isIdProvider(i.portalUrl,t)){e=i;break}return e}_addResource(t,e){e&&-1===this._getIdenticalSvcIdx(t,e)&&e.resources.push(t)}_removeResource(t,e){let i=-1;e&&(i=this._getIdenticalSvcIdx(t,e),i>-1&&e.resources.splice(i,1))}_useProxy(t,e){return e&&e.isAdmin&&!M(t.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(t.tokenServiceUrl)&&"10.1"==t.currentVersion+""&&!M(t.tokenServiceUrl,this._appOrigin)}_getOrigin(t){const e=new D(t);return e.scheme+"://"+e.host+(null!=e.port?":"+e.port:"")}_getServerInstanceRoot(t){const e=t.toLowerCase();let i=e.indexOf(this._agsRest);return-1===i&&this._isAdminResource(t)&&(i=this._agsAdmin.test(t)?t.replace(this._agsAdmin,"$1").length:t.search(this._adminSvcs)),-1===i&&(i=e.indexOf("/sharing")),-1===i&&"/"===e.substr(-1)&&(i=e.length-1),i>-1?t.substring(0,i):t}_hasSameServerInstance(t,e){return"/"===t.substr(-1)&&(t=t.slice(0,-1)),t=t.toLowerCase(),e=this._getServerInstanceRoot(e).toLowerCase(),t=this._normalizeAGOLorgDomain(t),e=this._normalizeAGOLorgDomain(e),(t=t.substr(t.indexOf(":")))===e.substr(e.indexOf(":"))}_normalizeAGOLorgDomain(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}_sanitizeUrl(t){const e=(H.request.proxyUrl||"").toLowerCase(),i=e?t.toLowerCase().indexOf(e+"?"):-1;return-1!==i&&(t=t.substring(i+e.length+1)),t=V(t),R(t).path}_isRESTService(t){return t.indexOf(this._agsRest)>-1}_isAdminResource(t){return this._agsAdmin.test(t)||this._adminSvcs.test(t)}_isServerRsrc(t){return this._isRESTService(t)||this._isAdminResource(t)}_isIdenticalService(t,e){let i;if(this._isRESTService(t)&&this._isRESTService(e)){const r=this._getSuffix(t).toLowerCase(),n=this._getSuffix(e).toLowerCase();if(i=r===n,!i){const t=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;i=r.replace(t,"$1")===n.replace(t,"$1")}}else this._isAdminResource(t)&&this._isAdminResource(e)?i=!0:this._isServerRsrc(t)||this._isServerRsrc(e)||!this._isPortalDomain(t)||(i=!0);return i}_isPortalDomain(t){const e=new D(t.toLowerCase()),i=this._portalConfig;let r=this._gwDomains.some((t=>t.regex.test(e.uri)));return!r&&i&&(r=this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),e.uri)),r||H.portalUrl&&(r=M(e,H.portalUrl,!0)),r||(r=this._portals.some((t=>this._hasSameServerInstance(t,e.uri)))),r=r||this._agsPortal.test(e.path),r}_isIdProvider(t,e){let i=-1,r=-1;this._gwDomains.forEach(((n,s)=>{-1===i&&n.regex.test(t)&&(i=s),-1===r&&n.regex.test(e)&&(r=s)}));let n=!1;if(i>-1&&r>-1&&(0===i||4===i?0!==r&&4!==r||(n=!0):1===i?1!==r&&2!==r||(n=!0):2===i?2===r&&(n=!0):3===i&&3===r&&(n=!0)),!n){const i=this.findServerInfo(e),r=i&&i.owningSystemUrl;r&&dr(i)&&this._isPortalDomain(r)&&this._isIdProvider(t,r)&&(n=!0)}return n}_getIdenticalSvcIdx(t,e){let i=-1;for(let r=0;r<e.resources.length;r++)if(this._isIdenticalService(t,e.resources[r])){i=r;break}return i}_getSuffix(t){return t.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(t){let e,i,r;if(this._isRESTService(t)||this._isAdminResource(t)){const r=this._getServerInstanceRoot(t);return e=r+"/admin/generateToken",i=L(t=r+"/rest/info",{query:{f:"json"}}).then((t=>t.data)),{adminUrl:e,promise:i}}if(this._isPortalDomain(t)){let e="";if(this._gwDomains.some((i=>(i.regex.test(t)&&(e=i.tokenServiceUrl),!!e))),e||this._portals.some((i=>(this._hasSameServerInstance(i,t)&&(e=i+this._gwTokenUrl),!!e))),e||(r=t.toLowerCase().indexOf("/sharing"),-1!==r&&(e=t.substring(0,r)+this._gwTokenUrl)),e||(e=this._getOrigin(t)+this._gwTokenUrl),e){const i=new D(t).port;/^http:\/\//i.test(t)&&"7080"===i&&(e=e.replace(/:7080/i,":7443")),e=e.replace(/http:/i,"https:")}return e}if(-1!==t.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_exchangeToken(t,e,i){return L(t+"/sharing/rest/oauth2/exchangeToken",{authMode:"anonymous",method:"post",query:{f:"json",client_id:e,token:i}}).then((t=>t.data.token))}_getPlatformSelf(t,e){return t=t.replace(/^http:/i,"https:"),L(t+"/sharing/rest/oauth2/platformSelf",{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":e,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json"},withCredentials:!0}).then((t=>t.data))}_getPortalSelf(t,e){let i;return this._gwDomains.some((e=>(e.regex.test(t)&&(i=e.customBaseUrl),!!i))),i?Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:i,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?t=t.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(e)&&(t=t.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),L(t,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then((t=>t.data)))}_doPortalSignIn(t){const e=this._portalConfig,i=window.location.href,r=this.findServerInfo(t);return!(!e&&!this._isPortalDomain(i)||!(r?r.hasPortal||r.owningSystemUrl&&this._isPortalDomain(r.owningSystemUrl):this._isPortalDomain(t))||!(this._isIdProvider(i,t)||e&&(this._hasSameServerInstance(this._getServerInstanceRoot(e.restBaseUrl),t)||this._isIdProvider(e.restBaseUrl,t))||M(i,t,!0)))}_checkProtocol(t,e,i,r){let n=!0;const s=r?e.adminTokenServiceUrl:e.tokenServiceUrl;return s.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&J(s)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:t,serverInfo:e}),!n)&&i(new $("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),n}_enqueue(t,e,i,r,n,s){return r||(r=F()),r.resUrl_=t,r.sinfo_=e,r.options_=i,r.admin_=n,r.refresh_=s,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(t),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(r)):this._xoReqs.push(r):this._doSignIn(r),r.promise}_doSignIn(t){this._busy=t,this._rejectOnPersistedPageShow=!1;const e=e=>{const i=t.options_&&t.options_.resource,r=t.resUrl_,n=t.refresh_;let s=!1;-1===this.credentials.indexOf(e)&&(n&&-1!==this.credentials.indexOf(n)?(n.userId=e.userId,n.token=e.token,n.expires=e.expires,n.validity=e.validity,n.ssl=e.ssl,n.creationTime=e.creationTime,s=!0,e=n):this.credentials.push(e)),e.resources||(e.resources=[]),e.resources.push(i||r),e.scope=this._isServerRsrc(r)?"server":"portal",e.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((t=>{if(!this._isIdenticalService(r,t.resUrl_)){const i=this._getSuffix(t.resUrl_);a[i]||(a[i]=!0,e.resources.push(t.resUrl_))}})),t.resolve(e),o.forEach((t=>{this._hasSameServerInstance(this._getServerInstanceRoot(r),t.resUrl_)?t.resolve(e):this._soReqs.push(t)})),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,s||this.emit("credential-create",{credential:e}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=e=>{t.reject(e),this._busy=t.resUrl_=t.sinfo_=t.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=(r,n,s,o)=>{var a,l;const h=t.sinfo_,c=!t.options_||!1!==t.options_.prompt,u=h.hasPortal&&this._findOAuthInfo(t.resUrl_);let d,f;if(r)e(new vr({userId:r,server:h.server,token:s||null,expires:null!=o?Number(o):null,ssl:!!n}));else if(window!==window.parent&&null!=(a=this._appUrlObj.query)&&a["arcgis-auth-origin"]&&null!=(l=this._appUrlObj.query)&&l["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),t.resUrl_)){var p;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const r=G(window,"message",(t=>{t.source===window.parent&&t.data&&("arcgis:auth:credential"===t.data.type?(r.remove(),t.data.credential.expires<Date.now()?i(new $("identity-manager:credential-request-failed","Parent application's token has expired.")):e(new vr(t.data.credential))):"arcgis:auth:error"===t.data.type&&(r.remove(),i("tokenExpiredError"===t.data.error.name?new $("identity-manager:credential-request-failed","Parent application's token has expired."):$.fromJSON(t.data.error))))}));v(null==(p=t.options_)?void 0:p.signal,(()=>{r.remove()}))}else if(u){let r=u._oAuthCred;if(!r){const t=new sr(u,pr),e=new sr(u,gr);t.isValid()&&e.isValid()?t.expires>e.expires?(r=t,e.destroy()):(r=e,t.destroy()):r=t.isValid()?t:e,u._oAuthCred=r}if(r.isValid())d=new vr({userId:r.userId,server:h.server,token:r.token,expires:r.expires,ssl:r.ssl,_oAuthCred:r}),u.appId!==r.appId&&this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._exchangeToken(d.server,u.appId,d.token).then((t=>{d.token=t,r.token=t,r.save(),e(d)})).catch((()=>{e(d)})):e(d);else if(this._oAuthHash&&this._hasSameServerInstance(u.portalUrl,this._oAuthHash.state.portalUrl)){const t=this._oAuthHash;d=new vr({userId:t.username,server:h.server,token:t.access_token,expires:Date.now()+1e3*Number(t.expires_in),ssl:"true"===t.ssl,oAuthState:t.state,_oAuthCred:r}),u.userId=d.userId,r.storage=t.persist?pr:gr,r.token=d.token,r.expires=d.expires,r.userId=d.userId,r.ssl=d.ssl,r.save(),this._oAuthHash=null,e(d)}else{const r=()=>{c?t._pendingDfd=this.oAuthSignIn(t.resUrl_,h,u,t.options_).then(e,i):(f=new $("identity-manager:not-authenticated","User is not signed in."),i(f))};this._doPortalSignIn(t.resUrl_)?t._pendingDfd=this._getPlatformSelf(h.server,u.appId).then((({portalUrl:t,token:i,username:n})=>{!t||M(t,this._appOrigin,!0)?(d=new vr({server:h.server,userId:n,token:i}),e(d)):r()})).catch(r):r()}}else if(c){if(this._checkProtocol(t.resUrl_,h,i,t.admin_)){let r=t.options_;t.admin_&&(r=r||{},r.isAdmin=!0),t._pendingDfd=this.signIn(t.resUrl_,h,r).then(e,i)}}else f=new $("identity-manager:not-authenticated","User is not signed in."),i(f)},n=()=>{const r=t.sinfo_,n=r.owningSystemUrl,s=t.options_;let o,a,l,h;if(s&&(o=s.token,a=s.error,l=s.prompt),h=this._findCredential(n,{token:o,resource:t.resUrl_}),!h)for(const t of this.credentials)if(this._isIdProvider(n,t.server)){h=t;break}if(h){const n=this.findCredential(t.resUrl_,h.userId);if(n)e(n);else if(fr(r,this._legacyFed)){const t=h.toJSON();t.server=r.server,t.resources=null,e(new vr(t))}else(t._pendingDfd=this.generateToken(this.findServerInfo(h.server),null,{serverUrl:t.resUrl_,token:h.token,signal:t.options_.signal,ssl:h.ssl})).then((i=>{e(new vr({userId:h.userId,server:r.server,token:i.token,expires:null!=i.expires?Number(i.expires):null,ssl:!!i.ssl,isAdmin:t.admin_,validity:i.validity}))}),i)}else this._busy=null,o&&(t.options_.token=null),(t._pendingDfd=this.getCredential(n.replace(/\/?$/,"/sharing"),{resource:t.resUrl_,owningTenant:r.owningTenant,signal:t.options_.signal,token:o,error:a,prompt:l})).then((()=>{this._enqueue(t.resUrl_,t.sinfo_,t.options_,t,t.admin_)}),(e=>{t.resUrl_=t.sinfo_=t.refresh_=null,t.reject(e)}))};this._errbackFunc=i;const s=t.sinfo_.owningSystemUrl,o=this._isServerRsrc(t.resUrl_),a=t.sinfo_._restInfoPms;a?a.promise.then((e=>{const i=t.sinfo_;if(i._restInfoPms){i.adminTokenServiceUrl=i._restInfoPms.adminUrl,i._restInfoPms=null,i.tokenServiceUrl=W("authInfo.tokenServicesUrl",e)||W("authInfo.tokenServiceUrl",e)||W("tokenServiceUrl",e),i.shortLivedTokenValidity=W("authInfo.shortLivedTokenValidity",e),i.currentVersion=e.currentVersion,i.owningTenant=e.owningTenant;const t=i.owningSystemUrl=e.owningSystemUrl;t&&this._portals.push(t)}o&&i.owningSystemUrl?n():r()}),(()=>{t.sinfo_._restInfoPms=null;const e=new $("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");i(e)})):o&&s?n():t.sinfo_._selfReq?t.sinfo_._selfReq.selfDfd.then((e=>{const i={};let r,n,s,o;return e&&(r=e.user&&e.user.username,i.username=r,i.allSSL=e.allSSL,n=e.supportsOAuth,s=e.currentVersion,"multitenant"===e.portalMode&&(o=e.customBaseUrl)),t.sinfo_.webTierAuth=!!r,r&&this.normalizeWebTierAuth?this.generateToken(t.sinfo_,null,{ssl:i.allSSL}).catch((()=>null)).then((t=>(i.portalToken=t&&t.token,i.tokenExpiration=t&&t.expires,i))):!r&&n&&parseFloat(s)>=4.4&&!this._findOAuthInfo(t.resUrl_)?this._generateOAuthInfo({portalUrl:t.sinfo_.server,customBaseUrl:o,owningTenant:t.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>i)):i})).catch((()=>null)).then((e=>{t.sinfo_._selfReq=null,e?r(e.username,e.allSSL,e.portalToken,e.tokenExpiration):r()})):r()}_generateOAuthInfo(t){let e,i,r=t.portalUrl;const n=t.customBaseUrl,s=t.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){i=window.location.href;let t=i.indexOf("?");t>-1&&(i=i.slice(0,t)),t=i.search(/\/(apps|home)\//),i=t>-1?i.slice(0,t):null}return o&&i?(this._hasTestedIfAppIsOnPortal=!0,e=L(i+"/sharing/rest",{query:{f:"json"}}).then((()=>{this.defaultOAuthInfo=new lr({appId:"arcgisonline",popupCallbackUrl:i+"/home/oauth-callback.html"})}))):e=Promise.resolve(),e.then((()=>{if(this.defaultOAuthInfo)return r=r.replace(/^http:/i,"https:"),L(r+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:s,client_id:this.defaultOAuthInfo.appId,redirect_uri:w(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then((t=>{if(t.data.valid){const e=this.defaultOAuthInfo.clone();e.portalUrl=t.data.urlKey&&n?"https://"+t.data.urlKey.toLowerCase()+"."+n:r,e.popup=window!==window.top||!(M(r,this._appOrigin)||this._gwDomains.some((t=>t.regex.test(r)&&t.regex.test(this._appOrigin)))),this.oAuthInfos.push(e)}}))}))}_doOAuthSignIn(t,e,i){const r={portalUrl:i.portalUrl};!i.popup&&i.preserveUrlHash&&window.location.hash&&(r.hash=window.location.hash);const n={client_id:i.appId,response_type:"token",state:JSON.stringify(r),expiration:i.expiration,locale:i.locale,redirect_uri:i.popup?w(i.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};i.forceLogin&&(n.force_login=!0),i.forceUserId&&i.userId&&(n.prepopulatedusername=i.userId),!i.popup&&this._doPortalSignIn(t)&&(n.redirectToUserOrgUrl=!0);const s=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",o=s+"?"+Y(n);if(i.popup){const t=window.open(o,"esriJSAPIOAuth",i.popupWindowFeatures);if(t)t.focus(),this._oAuthDfd.oAuthWin_=t,this._oAuthIntervalId=setInterval((()=>{if(t.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const t=this._oAuthDfd;if(t){const e=new $("identity-manager:user-aborted","ABORTED");t.reject(e)}}}),500),this._oAuthOnHashHandle=G(window,"arcgis:auth:hash",(t=>{this.setOAuthResponseHash(t.detail)}));else{const t=new $("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(t)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:n,authorizeUrl:s,resourceUrl:t,serverInfo:e,oAuthInfo:i}):window.location.href=o}}mr.prototype.declaredClass="esri.identity.IdentityManagerBase";let vr=class extends K.EventedAccessor{constructor(t){super(t),this._oAuthCred=null,this.tokenRefreshBuffer=2,t&&t._oAuthCred&&(this._oAuthCred=t._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const t=U.findServerInfo(this.server),e=t&&t.owningSystemUrl,i=!!e&&"server"===this.scope,r=i&&fr(t,U._legacyFed),n=t.webTierAuth,s=n&&U.normalizeWebTierAuth,o=ur[this.server],a=o&&o[this.userId];let l,h=this.resources&&this.resources[0],c=i&&U.findServerInfo(e),u={username:this.userId,password:a};if(n&&!s)return;i&&!c&&U.serverInfos.some((t=>(U._isIdProvider(e,t.server)&&(c=t),!!c)));const d=c&&U.findCredential(c.server,this.userId);if(!i||d){if(!r){if(i)l={serverUrl:h,token:d&&d.token,ssl:d&&d.ssl};else if(s)u=null,l={ssl:this.ssl};else{if(!a){let e;return h&&(h=U._sanitizeUrl(h),this._enqueued=1,e=U._enqueue(h,t,null,null,this.isAdmin,this),e.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),e}this.isAdmin&&(l={isAdmin:!0})}return U.generateToken(i?c:t,i?null:u,l).then((t=>{this.token=t.token,this.expires=null!=t.expires?Number(t.expires):null,this.creationTime=Date.now(),this.validity=t.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}d.refreshToken()}}refreshServerTokens(){"portal"===this.scope&&U.credentials.forEach((t=>{const e=U.findServerInfo(t.server),i=e&&e.owningSystemUrl;t!==this&&t.userId===this.userId&&i&&"server"===t.scope&&(U._hasSameServerInstance(this.server,i)||U._isIdProvider(i,this.server))&&(fr(e,U._legacyFed)?(t.token=this.token,t.expires=this.expires,t.creationTime=this.creationTime,t.validity=this.validity,t.emitTokenChange()):t.refreshToken())}))}emitTokenChange(t){clearTimeout(this._refreshTimer);const e=this.server&&U.findServerInfo(this.server),i=e&&e.owningSystemUrl,r=i&&U.findServerInfo(i);!1===t||i&&"portal"!==this.scope&&(!r||!r.webTierAuth||U.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const t=U.credentials.indexOf(this);t>-1&&U.credentials.splice(t,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const t=P({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(t.resources=e.slice()),t}_startRefreshTimer(){clearTimeout(this._refreshTimer);const t=6e4*this.tokenRefreshBuffer,e=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>e&&(i=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>t?i-t:i)}};t([l()],vr.prototype,"creationTime",void 0),t([l()],vr.prototype,"expires",void 0),t([l()],vr.prototype,"isAdmin",void 0),t([l()],vr.prototype,"oAuthState",void 0),t([l()],vr.prototype,"resources",void 0),t([l()],vr.prototype,"scope",void 0),t([l()],vr.prototype,"server",void 0),t([l()],vr.prototype,"ssl",void 0),t([l()],vr.prototype,"token",void 0),t([l()],vr.prototype,"tokenRefreshBuffer",void 0),t([l()],vr.prototype,"userId",void 0),t([l()],vr.prototype,"validity",void 0),vr=t([e("esri.identity.Credential")],vr);class br extends mr{}br.prototype.declaredClass="esri.identity.IdentityManager";const wr=new br;X(wr);export default wr;